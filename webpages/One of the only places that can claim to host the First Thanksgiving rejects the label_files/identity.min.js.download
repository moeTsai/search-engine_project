!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.Identity=t()}(this,function(){"use strict";var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function t(e,t){return e(t={exports:{}},t.exports),t.exports}function i(e){return"object"==typeof e?null!==e:"function"==typeof e}function v(e){if(!i(e))throw TypeError(e+" is not an object!");return e}function n(e){try{return!!e()}catch(e){return 1}}function r(e){return l?u.createElement(e):{}}function k(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}function s(e,t){return p.call(e,t)}function o(e){return"Symbol(".concat(void 0===e?"":e,")_",(++b+_).toString(36))}function a(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}function g(r,o,e){if(a(r),void 0===o)return r;switch(e){case 1:return function(e){return r.call(o,e)};case 2:return function(e,t){return r.call(o,e,t)};case 3:return function(e,t,n){return r.call(o,e,t,n)}}return function(){return r.apply(o,arguments)}}var m=t(function(e){var t=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=t)}),y=t(function(e){var t=e.exports={version:"2.6.11"};"number"==typeof __e&&(__e=t)}),d=(y.version,!n(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})),u=m.document,l=i(u)&&i(u.createElement),c=!d&&!n(function(){return 7!=Object.defineProperty(r("div"),"a",{get:function(){return 7}}).a}),f=Object.defineProperty,h={f:d?Object.defineProperty:function(e,t,n){if(v(e),t=function(e,t){if(!i(e))return e;var n,r;if(t&&"function"==typeof(n=e.toString)&&!i(r=n.call(e)))return r;if("function"==typeof(n=e.valueOf)&&!i(r=n.call(e)))return r;if(!t&&"function"==typeof(n=e.toString)&&!i(r=n.call(e)))return r;throw TypeError("Can't convert object to primitive value")}(t,!0),v(n),c)try{return f(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(e[t]=n.value),e}},S=d?function(e,t,n){return h.f(e,t,k(1,n))}:function(e,t,n){return e[t]=n,e},p={}.hasOwnProperty,b=0,_=Math.random(),w=t(function(e){var t="__core-js_shared__",n=m[t]||(m[t]={});(e.exports=function(e,t){return n[e]||(n[e]=void 0!==t?t:{})})("versions",[]).push({version:y.version,mode:"global",copyright:"Â© 2019 Denis Pushkarev (zloirock.ru)"})}),P=w("native-function-to-string",Function.toString),E=t(function(e){var i=o("src"),t="toString",a=(""+P).split(t);y.inspectSource=function(e){return P.call(e)},(e.exports=function(e,t,n,r){var o="function"==typeof n;o&&(s(n,"name")||S(n,"name",t)),e[t]!==n&&(o&&(s(n,i)||S(n,i,e[t]?""+e[t]:a.join(String(t)))),e===m?e[t]=n:r?e[t]?e[t]=n:S(e,t,n):(delete e[t],S(e,t,n)))})(Function.prototype,t,function(){return"function"==typeof this&&this[i]||P.call(this)})}),O="prototype",C=function(e,t,n){var r,o,i,a,s=e&C.F,u=e&C.G,l=e&C.S,c=e&C.P,f=e&C.B,d=u?m:l?m[t]||(m[t]={}):(m[t]||{})[O],h=u?y:y[t]||(y[t]={}),p=h[O]||(h[O]={});for(r in u&&(n=t),n)i=((o=!s&&d&&void 0!==d[r])?d:n)[r],a=f&&o?g(i,m):c&&"function"==typeof i?g(Function.call,i):i,d&&E(d,r,i,e&C.U),h[r]!=i&&S(h,r,a),c&&p[r]!=i&&(p[r]=i)};m.core=y,C.F=1,C.G=2,C.S=4,C.P=8,C.B=16,C.W=32,C.U=64,C.R=128;function U(e){return A.call(e).slice(8,-1)}function I(e){if(null==e)throw TypeError("Can't call method on  "+e);return e}function T(e){return L(I(e))}function j(e){return isNaN(e=+e)?0:(0<e?F:M)(e)}function R(e){return 0<e?N(j(e),9007199254740991):0}function D(l){return function(e,t,n){var r,o,i,a=T(e),s=R(a.length),u=(o=s,(r=j(r=n))<0?B(r+o,0):H(r,o));if(l&&t!=t){for(;u<s;)if((i=a[u++])!=i)return!0}else for(;u<s;u++)if((l||u in a)&&a[u]===t)return l||u||0;return!l&&-1}}var x=C,A={}.toString,L=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==U(e)?e.split(""):Object(e)},M=Math.ceil,F=Math.floor,N=Math.min,B=Math.max,H=Math.min,q=t(function(e){var t=w("wks"),n=m.Symbol,r="function"==typeof n;(e.exports=function(e){return t[e]||(t[e]=r&&n[e]||(r?n:o)("Symbol."+e))}).store=t}),z=q("unscopables"),V=Array.prototype;null==V[z]&&S(V,z,{});function J(e){V[z][e]=!0}var W=D(!0);x(x.P,"Array",{includes:function(e,t){return W(this,e,1<arguments.length?t:void 0)}}),J("includes");y.Array.includes;function G(e){return $[e]||($[e]=o(e))}function K(e){return Object(I(e))}var $=w("keys"),X=D(!1),Z=G("IE_PROTO"),Q="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(","),Y=Object.keys||function(e){return function(e,t){var n,r=T(e),o=0,i=[];for(n in r)n!=Z&&s(r,n)&&i.push(n);for(;t.length>o;)s(r,n=t[o++])&&(~X(i,n)||i.push(n));return i}(e,Q)},ee={f:Object.getOwnPropertySymbols},te={f:{}.propertyIsEnumerable},ne=Object.assign,re=!ne||n(function(){var e={},t={},n=Symbol(),r="abcdefghijklmnopqrst";return e[n]=7,r.split("").forEach(function(e){t[e]=e}),7!=ne({},e)[n]||Object.keys(ne({},t)).join("")!=r})?function(e,t){for(var n=K(e),r=arguments.length,o=1,i=ee.f,a=te.f;o<r;)for(var s,u=L(arguments[o++]),l=i?Y(u).concat(i(u)):Y(u),c=l.length,f=0;f<c;)s=l[f++],d&&!a.call(u,s)||(n[s]=u[s]);return n}:ne;x(x.S+x.F,"Object",{assign:re});y.Object.assign;function oe(s){return function(e){for(var t,n=T(e),r=Y(n),o=r.length,i=0,a=[];i<o;)t=r[i++],d&&!ie.call(n,t)||a.push(s?[t,n[t]]:n[t]);return a}}var ie=te.f,ae=oe(!0);x(x.S,"Object",{entries:function(e){return ae(e)}});y.Object.entries;var se=oe(!1);x(x.S,"Object",{values:function(e){return se(e)}});y.Object.values;function ue(e,t,n){if(i(r=t)&&(void 0!==(o=r[ce])?o:"RegExp"==U(r)))throw TypeError("String#"+n+" doesn't accept regex!");var r,o;return String(I(e))}function le(t){var n=/./;try{"/./"[t](n)}catch(e){try{return n[fe]=!1,!"/./"[t](n)}catch(e){}}return!0}var ce=q("match"),fe=q("match"),de="endsWith",he=""[de];x(x.P+x.F*le(de),"String",{endsWith:function(e,t){var n=ue(this,e,de),r=1<arguments.length?t:void 0,o=R(n.length),i=void 0===r?o:Math.min(R(r),o),a=String(e);return he?he.call(n,a,i):n.slice(i-a.length,i)===a}});y.String.endsWith;var pe="includes";x(x.P+x.F*le(pe),"String",{includes:function(e,t){return!!~ue(this,e,pe).indexOf(e,1<arguments.length?t:void 0)}});y.String.includes;function ve(e){var t,n,r;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),ge))?n:me?U(t):"Object"==(r=U(t))&&"function"==typeof t.callee?"Arguments":r}var ge=q("toStringTag"),me="Arguments"==U(function(){return arguments}()),ye={};ye[q("toStringTag")]="z",ye+""!="[object z]"&&E(Object.prototype,"toString",function(){return"[object "+ve(this)+"]"},!0);function be(){}function _e(e,t,n){e&&!s(e=n?e:e.prototype,Te)&&Ie(e,Te,{configurable:!0,value:t})}var we={},ke=d?Object.defineProperties:function(e,t){v(e);for(var n,r=Y(t),o=r.length,i=0;i<o;)h.f(e,n=r[i++],t[n]);return e},Se=m.document,Pe=Se&&Se.documentElement,Ee=G("IE_PROTO"),Oe="prototype",Ce=function(){var e,t=r("iframe"),n=Q.length;for(t.style.display="none",Pe.appendChild(t),t.src="javascript:",(e=t.contentWindow.document).open(),e.write("<script>document.F=Object<\/script>"),e.close(),Ce=e.F;n--;)delete Ce[Oe][Q[n]];return Ce()},Ue=Object.create||function(e,t){var n;return null!==e?(be[Oe]=v(e),n=new be,be[Oe]=null,n[Ee]=e):n=Ce(),void 0===t?n:ke(n,t)},Ie=h.f,Te=q("toStringTag"),je={};S(je,q("iterator"),function(){return this});function Re(){return this}function De(e,t,n,r,o,i,a){var s,u,l;function c(e){if(!Ne&&e in m)return m[e];switch(e){case"keys":case Be:return function(){return new n(this,e)}}return function(){return new n(this,e)}}u=t,l=r,(s=n).prototype=Ue(je,{next:k(1,l)}),_e(s,u+" Iterator");var f,d,h,p=t+" Iterator",v=o==Be,g=!1,m=e.prototype,y=m[Fe]||m["@@iterator"]||o&&m[o],b=y||c(o),_=o?v?c("entries"):b:void 0,w="Array"==t&&m.entries||y;if(w&&(h=Me(w.call(new e)))!==Object.prototype&&h.next&&(_e(h,p,!0),"function"!=typeof h[Fe]&&S(h,Fe,Re)),v&&y&&y.name!==Be&&(g=!0,b=function(){return y.call(this)}),!Ne&&!g&&m[Fe]||S(m,Fe,b),we[t]=b,we[p]=Re,o)if(f={values:v?b:c(Be),keys:i?b:c("keys"),entries:_},a)for(d in f)d in m||E(m,d,f[d]);else x(x.P+x.F*(Ne||g),t,f);return f}var xe,Ae=G("IE_PROTO"),Le=Object.prototype,Me=Object.getPrototypeOf||function(e){return e=K(e),s(e,Ae)?e[Ae]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?Le:null},Fe=q("iterator"),Ne=!([].keys&&"next"in[].keys()),Be="values",He=(xe=!0,function(e,t){var n,r,o=String(I(e)),i=j(t),a=o.length;return i<0||a<=i?xe?"":void 0:(n=o.charCodeAt(i))<55296||56319<n||i+1===a||(r=o.charCodeAt(i+1))<56320||57343<r?xe?o.charAt(i):n:xe?o.slice(i,i+2):r-56320+(n-55296<<10)+65536});De(String,"String",function(e){this._t=String(e),this._i=0},function(){var e,t=this._t,n=this._i;return n>=t.length?{value:void 0,done:!0}:(e=He(t,n),this._i+=e.length,{value:e,done:!1})});function qe(e,t){return{value:t,done:!!e}}var ze=De(Array,"Array",function(e,t){this._t=T(e),this._i=0,this._k=t},function(){var e=this._t,t=this._k,n=this._i++;return!e||n>=e.length?(this._t=void 0,qe(1)):qe(0,"keys"==t?n:"values"==t?e[n]:[n,e[n]])},"values");we.Arguments=we.Array,J("keys"),J("values"),J("entries");for(var Ve=q("iterator"),Je=q("toStringTag"),We=we.Array,Ge={CSSRuleList:!0,CSSStyleDeclaration:!1,CSSValueList:!1,ClientRectList:!1,DOMRectList:!1,DOMStringList:!1,DOMTokenList:!0,DataTransferItemList:!1,FileList:!1,HTMLAllCollection:!1,HTMLCollection:!1,HTMLFormElement:!1,HTMLSelectElement:!1,MediaList:!0,MimeTypeArray:!1,NamedNodeMap:!1,NodeList:!0,PaintRequestList:!1,Plugin:!1,PluginArray:!1,SVGLengthList:!1,SVGNumberList:!1,SVGPathSegList:!1,SVGPointList:!1,SVGStringList:!1,SVGTransformList:!1,SourceBufferList:!1,StyleSheetList:!0,TextTrackCueList:!1,TextTrackList:!1,TouchList:!1},Ke=Y(Ge),$e=0;$e<Ke.length;$e++){var Xe,Ze=Ke[$e],Qe=Ge[Ze],Ye=m[Ze],et=Ye&&Ye.prototype;if(et&&(et[Ve]||S(et,Ve,We),et[Je]||S(et,Je,Ze),we[Ze]=We,Qe))for(Xe in ze)et[Xe]||E(et,Xe,ze[Xe],!0)}function tt(e,t){var n,r=v(e).constructor;return void 0===r||null==(n=v(r)[dt])?t:a(n)}function nt(){var e,t=+this;bt.hasOwnProperty(t)&&(e=bt[t],delete bt[t],e())}function rt(e){nt.call(e.data)}var ot,it,at,st=q("iterator"),ut=Array.prototype,lt=q("iterator"),ct=y.getIteratorMethod=function(e){if(null!=e)return e[lt]||e["@@iterator"]||we[ve(e)]},ft=t(function(e){var h={},p={},t=e.exports=function(e,t,n,r,o){var i,a,s,u,l,c=o?function(){return e}:ct(e),f=g(n,r,t?2:1),d=0;if("function"!=typeof c)throw TypeError(e+" is not iterable!");if(void 0===(l=c)||we.Array!==l&&ut[st]!==l){for(s=c.call(e);!(a=s.next()).done;)if((u=function(t,e,n,r){try{return r?e(v(n)[0],n[1]):e(n)}catch(e){var o=t.return;throw void 0!==o&&v(o.call(t)),e}}(s,f,a.value,t))===h||u===p)return u}else for(i=R(e.length);d<i;d++)if((u=t?f(v(a=e[d])[0],a[1]):f(e[d]))===h||u===p)return u};t.BREAK=h,t.RETURN=p}),dt=q("species"),ht=m.process,pt=m.setImmediate,vt=m.clearImmediate,gt=m.MessageChannel,mt=m.Dispatch,yt=0,bt={},_t="onreadystatechange";pt&&vt||(pt=function(e){for(var t=[],n=1;n<arguments.length;)t.push(arguments[n++]);return bt[++yt]=function(){!function(e,t,n){var r=void 0===n;switch(t.length){case 0:return r?e():e.call(n);case 1:return r?e(t[0]):e.call(n,t[0]);case 2:return r?e(t[0],t[1]):e.call(n,t[0],t[1]);case 3:return r?e(t[0],t[1],t[2]):e.call(n,t[0],t[1],t[2]);case 4:return r?e(t[0],t[1],t[2],t[3]):e.call(n,t[0],t[1],t[2],t[3])}e.apply(n,t)}("function"==typeof e?e:Function(e),t)},ot(yt),yt},vt=function(e){delete bt[e]},"process"==U(ht)?ot=function(e){ht.nextTick(g(nt,e,1))}:mt&&mt.now?ot=function(e){mt.now(g(nt,e,1))}:gt?(at=(it=new gt).port2,it.port1.onmessage=rt,ot=g(at.postMessage,at,1)):m.addEventListener&&"function"==typeof postMessage&&!m.importScripts?(ot=function(e){m.postMessage(e+"","*")},m.addEventListener("message",rt,!1)):ot=_t in r("script")?function(e){Pe.appendChild(r("script"))[_t]=function(){Pe.removeChild(this),nt.call(e)}}:function(e){setTimeout(g(nt,e,1),0)});var wt={set:pt,clear:vt},kt=wt.set,St=m.MutationObserver||m.WebKitMutationObserver,Pt=m.process,Et=m.Promise,Ot="process"==U(Pt);function Ct(e){var n,r;this.promise=new e(function(e,t){if(void 0!==n||void 0!==r)throw TypeError("Bad Promise constructor");n=e,r=t}),this.resolve=a(n),this.reject=a(r)}function Ut(e){try{return{e:!1,v:e()}}catch(e){return{e:!0,v:e}}}function It(e,t){if(v(e),i(t)&&t.constructor===e)return t;var n=Tt.f(e);return(0,n.resolve)(t),n.promise}var Tt={f:function(e){return new Ct(e)}},jt=m.navigator,Rt=jt&&jt.userAgent||"",Dt=q("species"),xt=q("iterator"),At=!1;try{[7][xt]().return=function(){At=!0}}catch(Or){}var Lt,Mt,Ft,Nt,Bt,Ht,qt=wt.set,zt=(Nt=Ot?function(){Pt.nextTick(Vt)}:!St||m.navigator&&m.navigator.standalone?Et&&Et.resolve?(Ft=Et.resolve(void 0),function(){Ft.then(Vt)}):function(){kt.call(m,Vt)}:(Bt=!0,Ht=document.createTextNode(""),new St(Vt).observe(Ht,{characterData:!0}),function(){Ht.data=Bt=!Bt}),function(e){var t={fn:e,next:void 0};Mt&&(Mt.next=t),Lt||(Lt=t,Nt()),Mt=t});function Vt(){var e,t;for(Ot&&(e=Pt.domain)&&e.exit();Lt;){t=Lt.fn,Lt=Lt.next;try{t()}catch(e){throw Lt?Nt():Mt=void 0,e}}Mt=void 0,e&&e.enter()}function Jt(){}function Wt(e){var t;return!(!i(e)||"function"!=typeof(t=e.then))&&t}function Gt(c,t){var n;c._n||(c._n=!0,n=c._c,zt(function(){for(var u=c._v,l=1==c._s,e=0;n.length>e;)!function(e){var t,n,r,o=l?e.ok:e.fail,i=e.resolve,a=e.reject,s=e.domain;try{o?(l||(2==c._h&&dn(c),c._h=1),!0===o?t=u:(s&&s.enter(),t=o(u),s&&(s.exit(),r=!0)),t===e.promise?a(tn("Promise-chain cycle")):(n=Wt(t))?n.call(t,i,a):i(t)):a(u)}catch(e){s&&!r&&s.exit(),a(e)}}(n[e++]);c._c=[],c._n=!1,t&&!c._h&&cn(c)}))}function Kt(e){var t=this;t._d||(t._d=!0,(t=t._w||t)._v=e,t._s=2,t._a||(t._a=t._c.slice()),Gt(t,!0))}var $t,Xt,Zt,Qt,Yt,en="Promise",tn=m.TypeError,nn=m.process,rn=nn&&nn.versions,on=rn&&rn.v8||"",an=m[en],sn="process"==ve(nn),un=Xt=Tt.f,ln=!!function(){try{var e=an.resolve(1),t=(e.constructor={})[q("species")]=function(e){e(Jt,Jt)};return(sn||"function"==typeof PromiseRejectionEvent)&&e.then(Jt)instanceof t&&0!==on.indexOf("6.6")&&-1===Rt.indexOf("Chrome/66")}catch(e){}}(),cn=function(i){qt.call(m,function(){var e,t,n,r=i._v,o=fn(i);if(o&&(e=Ut(function(){sn?nn.emit("unhandledRejection",r,i):(t=m.onunhandledrejection)?t({promise:i,reason:r}):(n=m.console)&&n.error&&n.error("Unhandled promise rejection",r)}),i._h=sn||fn(i)?2:1),i._a=void 0,o&&e.e)throw e.v})},fn=function(e){return 1!==e._h&&0===(e._a||e._c).length},dn=function(t){qt.call(m,function(){var e;sn?nn.emit("rejectionHandled",t):(e=m.onrejectionhandled)&&e({promise:t,reason:t._v})})},hn=function(e){var n,r=this;if(!r._d){r._d=!0,r=r._w||r;try{if(r===e)throw tn("Promise can't be resolved itself");(n=Wt(e))?zt(function(){var t={_w:r,_d:!1};try{n.call(e,g(hn,t,1),g(Kt,t,1))}catch(e){Kt.call(t,e)}}):(r._v=e,r._s=1,Gt(r,!1))}catch(e){Kt.call({_w:r,_d:!1},e)}}};ln||(an=function(e){!function(e,t,n,r){if(!(e instanceof t)||void 0!==r&&r in e)throw TypeError(n+": incorrect invocation!")}(this,an,en,"_h"),a(e),$t.call(this);try{e(g(hn,this,1),g(Kt,this,1))}catch(e){Kt.call(this,e)}},($t=function(){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=function(e,t,n){for(var r in t)E(e,r,t[r],n);return e}(an.prototype,{then:function(e,t){var n=un(tt(this,an));return n.ok="function"!=typeof e||e,n.fail="function"==typeof t&&t,n.domain=sn?nn.domain:void 0,this._c.push(n),this._a&&this._a.push(n),this._s&&Gt(this,!1),n.promise},catch:function(e){return this.then(void 0,e)}}),Zt=function(){var e=new $t;this.promise=e,this.resolve=g(hn,e,1),this.reject=g(Kt,e,1)},Tt.f=un=function(e){return e===an||e===Qt?new Zt:Xt(e)}),x(x.G+x.W+x.F*!ln,{Promise:an}),_e(an,en),Yt=m[en],d&&Yt&&!Yt[Dt]&&h.f(Yt,Dt,{configurable:!0,get:function(){return this}}),Qt=y[en],x(x.S+x.F*!ln,en,{reject:function(e){var t=un(this);return(0,t.reject)(e),t.promise}}),x(x.S+x.F*!ln,en,{resolve:function(e){return It(this,e)}}),x(x.S+x.F*!(ln&&function(e,t){if(!t&&!At)return!1;var n=!1;try{var r=[7],o=r[xt]();o.next=function(){return{done:n=!0}},r[xt]=function(){return o},e(r)}catch(e){}return n}(function(e){an.all(e).catch(Jt)})),en,{all:function(e){var a=this,t=un(a),s=t.resolve,u=t.reject,n=Ut(function(){var r=[],o=0,i=1;ft(e,!1,function(e){var t=o++,n=!1;r.push(void 0),i++,a.resolve(e).then(function(e){n||(n=!0,r[t]=e,--i||s(r))},u)}),--i||s(r)});return n.e&&u(n.v),t.promise},race:function(e){var t=this,n=un(t),r=n.reject,o=Ut(function(){ft(e,!1,function(e){t.resolve(e).then(n.resolve,r)})});return o.e&&r(o.v),n.promise}}),x(x.P+x.R,"Promise",{finally:function(t){var n=tt(this,y.Promise||m.Promise),e="function"==typeof t;return this.then(e?function(e){return It(n,t()).then(function(){return e})}:t,e?function(e){return It(n,t()).then(function(){throw e})}:t)}}),x(x.S,"Promise",{try:function(e){var t=Tt.f(this),n=Ut(e);return(n.e?t.reject:t.resolve)(n.v),t.promise}});var pn,vn,gn,mn,yn,bn,_n,wn,kn,Sn,Pn;y.Promise;function En(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(e))throw new TypeError("Invalid character in header field name");return e.toLowerCase()}function On(e){return"string"!=typeof e&&(e=String(e)),e}function Cn(t){var e={next:function(){var e=t.shift();return{done:void 0===e,value:e}}};return gn&&(e[Symbol.iterator]=function(){return e}),e}function Un(t){this.map={},t instanceof Un?t.forEach(function(e,t){this.append(t,e)},this):Array.isArray(t)?t.forEach(function(e){this.append(e[0],e[1])},this):t&&Object.getOwnPropertyNames(t).forEach(function(e){this.append(e,t[e])},this)}function In(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function Tn(n){return new Promise(function(e,t){n.onload=function(){e(n.result)},n.onerror=function(){t(n.error)}})}function jn(e){var t=new FileReader,n=Tn(t);return t.readAsArrayBuffer(e),n}function Rn(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function Dn(){return this.bodyUsed=!1,this._initBody=function(e){if(this._bodyInit=e)if("string"==typeof e)this._bodyText=e;else if(mn&&Blob.prototype.isPrototypeOf(e))this._bodyBlob=e;else if(yn&&FormData.prototype.isPrototypeOf(e))this._bodyFormData=e;else if(vn&&URLSearchParams.prototype.isPrototypeOf(e))this._bodyText=e.toString();else if(bn&&mn&&wn(e))this._bodyArrayBuffer=Rn(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer]);else{if(!bn||!ArrayBuffer.prototype.isPrototypeOf(e)&&!kn(e))throw new Error("unsupported BodyInit type");this._bodyArrayBuffer=Rn(e)}else this._bodyText="";this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):vn&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},mn&&(this.blob=function(){var e=In(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?In(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(jn)}),this.text=function(){var e,t,n,r=In(this);if(r)return r;if(this._bodyBlob)return e=this._bodyBlob,t=new FileReader,n=Tn(t),t.readAsText(e),n;if(this._bodyArrayBuffer)return Promise.resolve(function(e){for(var t=new Uint8Array(e),n=new Array(t.length),r=0;r<t.length;r++)n[r]=String.fromCharCode(t[r]);return n.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},yn&&(this.formData=function(){return this.text().then(An)}),this.json=function(){return this.text().then(JSON.parse)},this}function xn(e,t){var n,r,o=(t=t||{}).body;if(e instanceof xn){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new Un(e.headers)),this.method=e.method,this.mode=e.mode,o||null==e._bodyInit||(o=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"omit",!t.headers&&this.headers||(this.headers=new Un(t.headers)),this.method=(n=t.method||this.method||"GET",r=n.toUpperCase(),-1<Sn.indexOf(r)?r:n),this.mode=t.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&o)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(o)}function An(e){var o=new FormData;return e.trim().split("&").forEach(function(e){var t,n,r;e&&(n=(t=e.split("=")).shift().replace(/\+/g," "),r=t.join("=").replace(/\+/g," "),o.append(decodeURIComponent(n),decodeURIComponent(r)))}),o}function Ln(e,t){t=t||{},this.type="default",this.status=void 0===t.status?200:t.status,this.ok=200<=this.status&&this.status<300,this.statusText="statusText"in t?t.statusText:"OK",this.headers=new Un(t.headers),this.url=t.url||"",this._initBody(e)}!function(t){function e(t){var e={next:function(){var e=t.shift();return{done:void 0===e,value:e}}};return o&&(e[Symbol.iterator]=function(){return e}),e}function r(e){return encodeURIComponent(e).replace(/%20/g,"+")}function i(e){return decodeURIComponent(String(e).replace(/\+/g," "))}var a,n,o=function(){try{return!!Symbol.iterator}catch(e){return!1}}();!function(){try{var e=t.URLSearchParams;return"a=1"===new e("?a=1").toString()&&"function"==typeof e.prototype.set}catch(e){return!1}}()&&((n=(a=function(e){Object.defineProperty(this,"_entries",{writable:!0,value:{}});var t=typeof e;if("undefined"!=t)if("string"==t)""!==e&&this._fromString(e);else if(e instanceof a){var n=this;e.forEach(function(e,t){n.append(t,e)})}else{if(null===e||"object"!=t)throw new TypeError("Unsupported input's type for URLSearchParams");if("[object Array]"===Object.prototype.toString.call(e))for(var r=0;r<e.length;r++){var o=e[r];if("[object Array]"!==Object.prototype.toString.call(o)&&2===o.length)throw new TypeError("Expected [string, any] as entry at index "+r+" of URLSearchParams's input");this.append(o[0],o[1])}else for(var i in e)e.hasOwnProperty(i)&&this.append(i,e[i])}}).prototype).append=function(e,t){e in this._entries?this._entries[e].push(String(t)):this._entries[e]=[String(t)]},n.delete=function(e){delete this._entries[e]},n.get=function(e){return e in this._entries?this._entries[e][0]:null},n.getAll=function(e){return e in this._entries?this._entries[e].slice(0):[]},n.has=function(e){return e in this._entries},n.set=function(e,t){this._entries[e]=[String(t)]},n.forEach=function(e,t){var n;for(var r in this._entries)if(this._entries.hasOwnProperty(r)){n=this._entries[r];for(var o=0;o<n.length;o++)e.call(t,n[o],r,this)}},n.keys=function(){var n=[];return this.forEach(function(e,t){n.push(t)}),e(n)},n.values=function(){var t=[];return this.forEach(function(e){t.push(e)}),e(t)},n.entries=function(){var n=[];return this.forEach(function(e,t){n.push([t,e])}),e(n)},o&&(n[Symbol.iterator]=n.entries),n.toString=function(){var n=[];return this.forEach(function(e,t){n.push(r(t)+"="+r(e))}),n.join("&")},t.URLSearchParams=a);var s=t.URLSearchParams.prototype;"function"!=typeof s.sort&&(s.sort=function(){var n=this,r=[];this.forEach(function(e,t){r.push([t,e]),n._entries||n.delete(t)}),r.sort(function(e,t){return e[0]<t[0]?-1:e[0]>t[0]?1:0}),n._entries&&(n._entries={});for(var e=0;e<r.length;e++)this.append(r[e][0],r[e][1])}),"function"!=typeof s._fromString&&Object.defineProperty(s,"_fromString",{enumerable:!1,configurable:!1,writable:!1,value:function(e){if(this._entries)this._entries={};else{var n=[];this.forEach(function(e,t){n.push(t)});for(var t=0;t<n.length;t++)this.delete(n[t])}for(var r,o=(e=e.replace(/^\?/,"")).split("&"),t=0;t<o.length;t++)r=o[t].split("="),this.append(i(r[0]),1<r.length?i(r[1]):"")}})}(void 0!==e?e:"undefined"!=typeof window?window:"undefined"!=typeof self?self:e),function(f){var t,n;function e(e,t){"string"!=typeof e&&(e=String(e));var n,r=document;if(t&&(void 0===f.location||t!==f.location.href)){(n=(r=document.implementation.createHTMLDocument("")).createElement("base")).href=t,r.head.appendChild(n);try{if(0!==n.href.indexOf(t))throw new Error(n.href)}catch(e){throw new Error("URL unable to set base "+t+" due to "+e)}}var o=r.createElement("a");o.href=e,n&&(r.body.appendChild(o),o.href=o.href);var i=r.createElement("input");if(i.type="url",i.value=e,":"===o.protocol||!/:/.test(o.href)||!i.checkValidity()&&!t)throw new TypeError("Invalid URL");Object.defineProperty(this,"_anchorElement",{value:o});var a=new f.URLSearchParams(this.search),s=!0,u=!0,l=this;["append","delete","set"].forEach(function(e){var t=a[e];a[e]=function(){t.apply(a,arguments),s&&(u=!1,l.search=a.toString(),u=!0)}}),Object.defineProperty(this,"searchParams",{value:a,enumerable:!0});var c=void 0;Object.defineProperty(this,"_updateSearchParams",{enumerable:!1,configurable:!1,writable:!1,value:function(){this.search!==c&&(c=this.search,u&&(s=!1,this.searchParams._fromString(this.search),s=!0))}})}if(!function(){try{var e=new f.URL("b","http://a");return e.pathname="c d","http://a/c%20d"===e.href&&e.searchParams}catch(e){return!1}}()&&(t=f.URL,n=e.prototype,["hash","host","hostname","port","protocol"].forEach(function(e){var t;t=e,Object.defineProperty(n,t,{get:function(){return this._anchorElement[t]},set:function(e){this._anchorElement[t]=e},enumerable:!0})}),Object.defineProperty(n,"search",{get:function(){return this._anchorElement.search},set:function(e){this._anchorElement.search=e,this._updateSearchParams()},enumerable:!0}),Object.defineProperties(n,{toString:{get:function(){var e=this;return function(){return e.href}}},href:{get:function(){return this._anchorElement.href.replace(/\?$/,"")},set:function(e){this._anchorElement.href=e,this._updateSearchParams()},enumerable:!0},pathname:{get:function(){return this._anchorElement.pathname.replace(/(^\/?)/,"/")},set:function(e){this._anchorElement.pathname=e},enumerable:!0},origin:{get:function(){var e={"http:":80,"https:":443,"ftp:":21}[this._anchorElement.protocol],t=this._anchorElement.port!=e&&""!==this._anchorElement.port;return this._anchorElement.protocol+"//"+this._anchorElement.hostname+(t?":"+this._anchorElement.port:"")},enumerable:!0},password:{get:function(){return""},set:function(e){},enumerable:!0},username:{get:function(){return""},set:function(e){},enumerable:!0}}),e.createObjectURL=function(e){return t.createObjectURL.apply(t,arguments)},e.revokeObjectURL=function(e){return t.revokeObjectURL.apply(t,arguments)},f.URL=e),void 0!==f.location&&!("origin"in f.location)){var r=function(){return f.location.protocol+"//"+f.location.hostname+(f.location.port?":"+f.location.port:"")};try{Object.defineProperty(f.location,"origin",{get:r,enumerable:!0})}catch(e){setInterval(function(){f.location.origin=r()},100)}}}(void 0!==e?e:"undefined"!=typeof window?window:"undefined"!=typeof self?self:e),(pn="undefined"!=typeof self?self:void 0).fetch||(vn="URLSearchParams"in pn,gn="Symbol"in pn&&"iterator"in Symbol,mn="FileReader"in pn&&"Blob"in pn&&function(){try{return new Blob,!0}catch(e){return!1}}(),yn="FormData"in pn,(bn="ArrayBuffer"in pn)&&(_n=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],wn=function(e){return e&&DataView.prototype.isPrototypeOf(e)},kn=ArrayBuffer.isView||function(e){return e&&-1<_n.indexOf(Object.prototype.toString.call(e))}),Un.prototype.append=function(e,t){e=En(e),t=On(t);var n=this.map[e];this.map[e]=n?n+","+t:t},Un.prototype.delete=function(e){delete this.map[En(e)]},Un.prototype.get=function(e){return e=En(e),this.has(e)?this.map[e]:null},Un.prototype.has=function(e){return this.map.hasOwnProperty(En(e))},Un.prototype.set=function(e,t){this.map[En(e)]=On(t)},Un.prototype.forEach=function(e,t){for(var n in this.map)this.map.hasOwnProperty(n)&&e.call(t,this.map[n],n,this)},Un.prototype.keys=function(){var n=[];return this.forEach(function(e,t){n.push(t)}),Cn(n)},Un.prototype.values=function(){var t=[];return this.forEach(function(e){t.push(e)}),Cn(t)},Un.prototype.entries=function(){var n=[];return this.forEach(function(e,t){n.push([t,e])}),Cn(n)},gn&&(Un.prototype[Symbol.iterator]=Un.prototype.entries),Sn=["DELETE","GET","HEAD","OPTIONS","POST","PUT"],xn.prototype.clone=function(){return new xn(this,{body:this._bodyInit})},Dn.call(xn.prototype),Dn.call(Ln.prototype),Ln.prototype.clone=function(){return new Ln(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new Un(this.headers),url:this.url})},Ln.error=function(){var e=new Ln(null,{status:0,statusText:""});return e.type="error",e},Pn=[301,302,303,307,308],Ln.redirect=function(e,t){if(-1===Pn.indexOf(t))throw new RangeError("Invalid status code");return new Ln(null,{status:t,headers:{location:e}})},pn.Headers=Un,pn.Request=xn,pn.Response=Ln,pn.fetch=function(n,o){return new Promise(function(r,e){var t=new xn(n,o),i=new XMLHttpRequest;i.onload=function(){var e,o,t={status:i.status,statusText:i.statusText,headers:(e=i.getAllResponseHeaders()||"",o=new Un,e.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach(function(e){var t,n=e.split(":"),r=n.shift().trim();r&&(t=n.join(":").trim(),o.append(r,t))}),o)};t.url="responseURL"in i?i.responseURL:t.headers.get("X-Request-URL");var n="response"in i?i.response:i.responseText;r(new Ln(n,t))},i.onerror=function(){e(new TypeError("Network request failed"))},i.ontimeout=function(){e(new TypeError("Network request failed"))},i.open(t.method,t.url,!0),"include"===t.credentials?i.withCredentials=!0:"omit"===t.credentials&&(i.withCredentials=!1),"responseType"in i&&mn&&(i.responseType="blob"),t.headers.forEach(function(e,t){i.setRequestHeader(t,e)}),i.send(void 0===t._bodyInit?null:t._bodyInit)})},pn.fetch.polyfill=!0);var Mn=function(e){var t=0<arguments.length&&void 0!==e?e:location.port;return/^(3|4)[0-9]{1,3}/.test(t)},Fn=function(e,t){return t?e.split(".")[e.split(".").length-2]+"."+e.split(".")[e.split(".").length-1]:"nbc.com"},Nn=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},Bn=function(e,t,n){return t&&Hn(e.prototype,t),n&&Hn(e,n),e};function Hn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function qn(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function zn(e,t){var n={};for(var r in e)0<=t.indexOf(r)||Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n}var Vn=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Jn=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},Wn=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,o=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{!r&&s.return&&s.return()}finally{if(o)throw i}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},Gn=(Bn(Kn,[{key:"setEnabled",value:function(e){this._enabled=e}},{key:"isEnabled",value:function(){return this._enabled}},{key:"getCookie",value:function(e,t){var n=1<arguments.length&&void 0!==t?t:{};if(this._enabled){var r=this._cookieNames[e]||e;n.userId&&(r=r+"--"+n.userId);var o=document.cookie.split(";").filter(function(e){return e.includes(r+"=")});return o[0]&&o[0].replace(r+"=","").trim()||null}}},{key:"removeCookie",value:function(e){var t;this._enabled&&(t=this._cookieNames[e]||e,this.setCookie(t,"",{},-1))}},{key:"setCookie",value:function(e,t,n,r){var o,i,a,s,u=2<arguments.length&&void 0!==n?n:{},l=3<arguments.length&&void 0!==r?r:365;this._enabled&&(o=[],i=this._cookieNames[e]||e,u.userId&&(i=i+"--"+u.userId),a=new Date,l=new Date(a.getTime()+24*l*60*60*1e3),o.push(i+"="+t),o.push("expires="+l.toUTCString()),o.push("path=/"),o.push("SameSite=None"),o.push("Secure"),s=Fn(window.location.hostname,this._config.loadDomainDynamically),this._local||o.push("domain=."+s),document.cookie=o.join(";"))}},{key:"subscribe",value:function(t,n,e){var r=this,o=2<arguments.length&&void 0!==e?e:1e3;if(this._enabled){var i=this.getCookie(t);return window.setInterval(function(){var e=r.getCookie(t);if(i!==e)return(i=e)?n(e):n()},o)}}},{key:"unsubscribe",value:function(e){this._enabled&&window.clearInterval(e)}}]),Kn);function Kn(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};Nn(this,Kn);var t,n,r,o="properties";e.showAttributes&&(n=(t=e.showAttributes).show,r=t.season,n&&r&&(o=n+"S"+r)),this._cookieNames={crossApp:"park-crossApp",crossAppToken:"park-crossAppToken",properties:"park-"+o,token:"park-fr",userData:"park-userData",profile:"park-profile"},this._local=Mn(),this._enabled=!1,this._config=e}var $n=(Bn(Xn,null,[{key:"credentialKeys",get:function(){return["email","facebookId","id","tcDate","username"]}},{key:"standardMap",get:function(){return{address:{label:"Address (line 1)"},address2:{label:"Address (line 2)"},birthday:{label:"Birthday",type:"date"},country:{label:"Country"},firstName:{label:"First name"},gender:{label:"Gender"},lastName:{label:"Last name"},phone:{label:"Telephone number",type:"tel"},state:{label:"State"},zip:{label:"Zip Code"},zipCode:{label:"Zip Code"},dob:{label:"Date of Birth"}}}}]),Xn);function Xn(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.label,n=void 0===t?"":t,r=e.detail,o=void 0===r?"":r,i=e.placeholder,a=void 0===i?"":i,s=e.type,u=void 0===s?"string":s,l=e.defaultValue,c=e.value,f=e.request,d=void 0!==f&&f,h=e.required,p=void 0!==h&&h,v=e.mask,g=e.min,m=e.max,y=e.pattern,b=e.mode,_=e.errorMessage,w=e.order,k=e.options;Nn(this,Xn),"date"!==u||w||(w=["month","day","year"]),Object.assign(this,{label:n,detail:o,placeholder:a,type:u,defaultValue:l,value:c,request:d,required:p,mask:v,min:g,max:m,pattern:y,mode:b,errorMessage:_,order:w,options:k}),Object.freeze(this)}var Zn=(Bn(Qn,null,[{key:"serverKeyMap",get:function(){return{id:"_id",revisionId:"_rev",email:"mail",username:"userName",password:"password",firstName:"givenName",lastName:"sn",phone:"telephoneNumber",address:"postalAddress",address2:"address2",zip:"serviceZip",zipCode:"serviceZip",state:"stateProvince",birthday:"DOB",tcDate:"termsAndConditionsAgreementDate"}}}]),Qn);function Qn(e){var i=this,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};Nn(this,Qn);var s=Qn.serverKeyMap;Object.entries(e.properties).forEach(function(e){var t=Wn(e,2),n=t[0],r=t[1],o=s[n];i[n]=o&&o in a?a[o]:n in a?a[n]:r.value}),Object.freeze(this)}var Yn=(Bn(er,[{key:"_onBridgeMessage",value:function(e,t){switch(e){case this._commandList.get:this._callbacks.get&&0<this._callbacks.get.length&&this._callbacks.get.forEach(function(e){return e(t)});break;case this._commandList.remove:this._callbacks.remove&&0<this._callbacks.remove.length&&this._callbacks.remove.forEach(function(e){return e(t)});break;case this._commandList.set:this._callbacks.set&&0<this._callbacks.set.length&&this._callbacks.set.forEach(function(e){return e(t)})}}},{key:"init",value:function(){var n=this;return new Promise(function(e,t){n._nativeController.init().then(function(){return n._nativeController.subscribe(n._onBridgeMessage),e()}).catch(function(){return t()})})}},{key:"command",value:function(e,t){var n=this._commandList[e];if(!n)return Error("Command name does not exist.");this._nativeController.sendCommand(n,t)}},{key:"on",value:function(e,t){if(!this._commandList[e])return Error("Command name does not exist.");this._callbacks[e]||(this._callbacks[e]=[]),this._callbacks[e].push(t)}},{key:"remove",value:function(){this.command("remove",{})}}]),er);function er(e){Nn(this,er),Object.assign(this,{_callbacks:{},_nativeController:e}),this._commandList={get:"GetStoredCredentials",remove:"RemoveStoredCredentials",set:"StoreCredentials"},this._onBridgeMessage=this._onBridgeMessage.bind(this)}var tr=(Bn(nr,[{key:"loginByEmail",value:function(e,t,n){var r=2<arguments.length&&void 0!==n?n:{headers:{}},o=btoa(encodeURIComponent(t).replace(/%([0-9A-F]{2})/g,function(e,t){return String.fromCharCode(parseInt(t,16))}));return this._server.call("api/2020-10/profile/email/session",{method:"GET",headers:Vn({"X-IDM-Password":"=?UTF-8?B?"+o+"?=","X-IDM-Username":e},r.headers)})}},{key:"registerByEmail",value:function(t,e){var n=this,r=1<arguments.length&&void 0!==e?e:{headers:{}};return t.userName||(t.userName=t.mail),this._server.call("api/2020-10/profile/email/register",{method:"POST",headers:r.headers,body:t}).then(function(e){return 200===e.result.code?n.loginByEmail(t.mail,t.password,{headers:Vn({vppa_re_opt_in:!1},r.headers)}):e})}},{key:"externalRegister",value:function(e,t,n){var r=Vn({},(2<arguments.length&&void 0!==n?n:{headers:{}}).headers);switch(t){case"facebook":r.access_token=e;break;default:r.id_token=e}return this._server.call("api/2020-10/profile/"+t+"/register",{method:"POST",headers:r})}},{key:"externalSession",value:function(e,t,n){var r=Vn({},(2<arguments.length&&void 0!==n?n:{headers:{}}).headers);switch(t){case"facebook":r.access_token=e;break;default:r.id_token=e}return this._server.call("api/2020-10/profile/"+t+"/session",{method:"GET",headers:r})}},{key:"getUserInfo",value:function(e,t,n){function r(e){var t={},n=e._id;return n?(o._cookieHelpers.getCookie("properties",{userId:n})&&(t=JSON.parse(o._cookieHelpers.getCookie("properties",{userId:n}))),Object.assign(e,t)):e}var o=this,i=1<arguments.length&&void 0!==t?t:null,a=2<arguments.length&&void 0!==n?n:{headers:{}};return new Promise(function(t,n){i?t(r(i)):o._server.call("api/2020-10/profile",{method:"GET",headers:Vn({session_token:e},a.headers)}).then(function(e){200===e.result.code&&e.profile?t(r(e.profile)):n(e.result)}).catch(function(e){return n(e)})})}},{key:"updateProfile",value:function(c,f,e,t,n){var d=2<arguments.length&&void 0!==e?e:null,h=this,p=t,v=4<arguments.length&&void 0!==n?n:{headers:{}};return new Promise(function(e,t){var n,r,o,i,a=[],s={},u=$n.standardMap,l=Zn.serverKeyMap;return Object.keys(p).forEach(function(e){var t={field:l[e]||e,value:p[e]};if(Object.keys(u).includes(e))t.operation="replace",a.push(t);else{if("mail"===t.field)return;s[t.field]=t.value}}),0<Object.keys(s).length&&(r=(n=h._cookieHelpers.getCookie("properties",{userId:d}))?JSON.parse(n):{},o=Object.assign(r,s),i=JSON.stringify(o),h._cookieHelpers.setCookie("properties",i,{userId:d})),0<a.length?h._server.call("api/2020-10/profile",{method:"PATCH",headers:Vn({session_token:c,"X-IDM-Update-Rev":f},v.headers),body:a}).then(e,t):e({status:"Success"})})}},{key:"unauthenticate",value:function(e,t,n){var r,o=2<arguments.length&&void 0!==n?n:{headers:{}};return t&&(r=new Yn(t)).init().then(function(){"iOS"===window.nativeWrapper.os?r.remove(e):"Android"===window.nativeWrapper.os&&t.sendCommand("DisableAutoSignIn",{})}),this._server.call("openam/json/realms/root/sessions/?_action=logout",{method:"POST",headers:Vn({iplanetdirectorypro:e},o.headers)})}}]),nr);function nr(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.server,n=e.config,r=e.useCookie,o=void 0!==r&&r;Nn(this,nr),this._server=t,this._cookieHelpers=new Gn(n),this._cookieHelpers.setEnabled(o),this._local=Mn();var i=location.origin.endsWith("id.nbc.com-sdk.s3-website-us-east-1.amazonaws.com");this._proxied=this._local||i}var rr=(Bn(or,null,[{key:"request",value:function(e){var t=this,n=e.server,r=e.key,o=e.configLocationHost,i=o?o.replace(/\/?$/,"/"):null;return n.sdk((i?"":"config/")+r+".json",i).then(function(e){return new or(e)},function(e){if(o)return window.console.error("configLocationHost property error, falling back to nbc.com hosted config:",e),t.request({server:n,key:r})})}}]),or);function or(e){var t=e.defaultPage,n=void 0===t?"signUp":t,r=e.redirectUrls,o=void 0===r?[]:r,i=e.redirectDelay,a=void 0===i?1e3:i,s=e.redirectTimeout,u=void 0===s?5e3:s,l=e.loadDomainDynamically,c=void 0!==l&&l,f=e.logoutRedirectTimeout,d=void 0===f?5e3:f,h=e.properties,p=void 0===h?{}:h,v=e.apple,g=void 0===v?{}:v,m=e.facebook,y=void 0===m?{}:m,b=e.google,_=void 0===b?{}:b,w=e.peacock,k=void 0===w?{}:w,S=e.sessionTimeout,P=void 0===S?31536e3:S,E=e.userTimeout,O=void 0===E?3600:E,C=e.disableSmartLock,U=void 0!==C&&C,I=e.theme,T=void 0===I?{}:I,j=e.analytics,R=void 0===j?{}:j,D=e.showAttributes,x=void 0===D?{}:D,A=e.launchdarkly,L=void 0===A?{}:A,M=e.zeroBounce,F=void 0===M?{}:M;Nn(this,or);var N=$n.credentialKeys,B=Zn.serverKeyMap,H=Object.keys(B),q=Object.values(B);p.id||(p.id={}),p.revisionId||(p.revisionId={}),y.appId||(y.appId="1692464401052790"),y.permissions||(y.permissions=["public_profile","email"]),y.version||(y.version="v3.1"),Object.entries(p).forEach(function(e){var t=Wn(e,2),n=t[0],r=t[1],o=void 0===r?{}:r;if(N.includes(n)&&0<Object.keys(o).length)throw new Error("Credential properties can not be configured in IdentityConfig");var i=q.indexOf(n);if(0<=i)throw new Error('Illegal property key in IdentityConfig: "'+n+'", use "'+H[i]+'" instead');p[n]=new $n(Vn({},$n.standardMap[n],o))}),Object.assign(this,{defaultPage:n,redirectUrls:o,redirectDelay:a,redirectTimeout:u,loadDomainDynamically:c,logoutRedirectTimeout:d,properties:p,apple:g,facebook:y,google:_,peacock:k,sessionTimeout:P,userTimeout:O,disableSmartLock:U,theme:T,analytics:R,showAttributes:x,launchdarkly:L,zeroBounce:F}),Object.freeze(this)}var ir=(Bn(ar,[{key:"on",value:function(n,r){var o=this;if("string"!=typeof n)throw new Error("Type argument passed to Observable#on() is not specified or not a string");if("function"!=typeof r)throw new Error("Callback function passed to Observable#on() is not specified or not a function");return this._observers[n]||(this._observers[n]=[]),-1===this._observers[n].indexOf(r)&&this._observers[n].push(r),function(){var e=o._observers[n],t=e.indexOf(r);0<=t&&e.splice(t,1)}}},{key:"notify",value:function(e,t){Array.isArray(this._observers[e])&&this._observers[e].forEach(function(e){try{e(t)}catch(e){console.log(e)}})}}]),ar);function ar(){Nn(this,ar),this._observers=[]}var sr=(qn(ur,ir),Bn(ur,[{key:"init",value:function(){var n=this;return new Promise(function(e,t){n._wrapperPromise.then(e,t)})}},{key:"subscribe",value:function(e,t){var n=1<arguments.length&&void 0!==t?t:"CommandResult";this._onMessage||(this._onMessage=[]),this._onMessage.push({type:n,callback:e})}},{key:"onMessage",value:function(r){this._previousOnMessage&&this._previousOnMessage(r);var o=r.type||"Event",i=r.subject;this._wrapperReady||"BridgeReady"!==i||this.wrapperReady(),this._onMessage&&0<this._onMessage.length&&this._onMessage.forEach(function(e){var t=e.type,n=e.callback;t===o&&n(i,r)})}},{key:"onWrapper",value:function(){return this._wrapper=window.nativeWrapper,window.nativeWrapper}},{key:"wrapperReady",value:function(){this.notify("nativeWrapperIsReady",{ready:!0})}},{key:"sendMessage",value:function(t){return this._wrapperPromise.then(function(e){return e.sendMessage(t)})}},{key:"sendCommand",value:function(e,t){var n=1<arguments.length&&void 0!==t?t:{},r=this._commandIdCounter++;this.sendMessage({type:"Command",subject:e,commandId:r,payload:n})}},{key:"initialized",get:function(){return this._initialized}}]),ur);function ur(){Nn(this,ur);var r=Jn(this,(ur.__proto__||Object.getPrototypeOf(ur)).call(this));return Object.assign(r,{_commandIdCounter:1,_wrapperReady:!1}),r._wrapperPromise=new Promise(function(t,e){var n=setTimeout(e,5e3);r.on("nativeWrapperIsReady",function(e){if(e&&e.ready)return r._wrapperReady=!0,clearTimeout(n),t(!0)})}).then(r.onWrapper.bind(r)),r._wrapper=window.nativeWrapper,r._wrapper&&r._wrapper.sendMessage?(r.wrapperReady(),r.sendMessage({type:"Event",subject:"AppReady"})):r._wrapper=window.nativeWrapper={},"function"==typeof r._wrapper.onMessage&&(r._previousOnMessage=r._wrapper.onMessage),r._wrapper.onMessage=r.onMessage.bind(r),r}function lr(e){return e?(e^16*Math.random()>>e/4).toString(16):([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,lr)}var cr=(Bn(fr,[{key:"request",value:function(e,t){function a(){return n.request(e,r)}var n=this,r=1<arguments.length&&void 0!==t?t:{},o=r.headers,i=void 0===o?{}:o,s=r.body,u=r.timeout,l=void 0===u?this.timeout:u,c=zn(r,["headers","body","timeout"]);c.headers=new Headers(i),s&&(c.headers.set("Content-Type","application/json"),c.body=JSON.stringify(s));var f=new URL(e,this.url),d=fetch(f.toString(),c).then(function(e){var n=e.ok,r=e.status,o=e.statusText,t=e.headers.get("content-type");if(t&&-1!==t.indexOf("application/json"))return e.json().then(function(e){if(n)return e;var t=new Error("Response not OK ("+r+" - "+o+")");throw Object.assign(t,e)}).catch(function(e){throw Object.assign(e,{status:r,statusText:o,retry:a})});var i=new Error("Response must be JSON");throw Object.assign(i,{code:422})});return l?new Promise(function(e,t){setTimeout(function(){var e=new Error("Timeout after "+l+" seconds");Object.assign(e,{status:0,statusText:"Timeout",retry:a}),t(e)},1e3*l),d.then(e,t)}):d}},{key:"getCallUrl",value:function(e){var t=0<arguments.length&&void 0!==e?e:"",n=this.url;return(Mn()||location.origin.endsWith("id.nbc.com-sdk.s3-website-us-east-1.amazonaws.com"))&&(n="https://us-central1-nbc-id-sdk.cloudfunctions.net/proxy/"+this.env+"/"),new URL(t,n).toString()}},{key:"call",value:function(e,t){var n=1<arguments.length&&void 0!==t?t:{},r=n.headers,o=void 0===r?{}:r,i=zn(n,["headers"]);return this.request(this.getCallUrl(e),Vn({headers:Vn({"Cache-Control":"no-cache",idmVersion:this.idmVersion,idm_tx_ref:lr(),"X-IDM-Brand-Source":(this.config.showAttributes||{}).IDMBrandSource||""},o)},i))}},{key:"getSdkUrl",value:function(e,t){var n=0<arguments.length&&void 0!==e?e:"",r=(1<arguments.length&&void 0!==t?t:null)||(this.useLocalConfig?this.url+"/public/":this.url+"/sdk/"),o=new URL(n,r);return o.searchParams?o.searchParams.set("version",this.sdkVersion):o.search&&o.search.set("version",this.sdkVersion),o.toString()}},{key:"sdk",value:function(e,t,n){var r=1<arguments.length&&void 0!==t?t:null,o=2<arguments.length&&void 0!==n?n:{};return this.request(this.getSdkUrl(e,r),o)}},{key:"setConfig",value:function(e){this.config=e}},{key:"setUrl",value:function(){var e=Fn(window.location.hostname,this.config.loadDomainDynamically);this.url=this.useLocalConfig?"http://localhost:3000":"production"===this.env?"https://id."+e:"https://"+this.env+"-id."+e}}]),fr);function fr(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.env,n=void 0===t?"production":t,r=e.configDomain,o=void 0===r?Fn(window.location.hostname,!0):r,i=e.idmVersion,a=void 0===i?"v2":i,s=e.useLocalConfig,u=void 0!==s&&s,l=e.sdkVersion,c=void 0===l?"test":l,f=e.timeout,d=void 0===f?20:f;Nn(this,fr),Object.assign(this,{config:{},env:n,idmVersion:a,useLocalConfig:u,sdkVersion:c,timeout:d,url:u?"http://localhost:3000":"production"===n?"https://id."+o:"https://"+n+"-id."+o,configUrl:u?"http://localhost:3000":"production"===n?"https://id.nbc.com":"https://"+n+"-id.nbc.com"})}var dr=(Bn(hr,[{key:"log",value:function(){var e;if(this.enabled){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];(e=console).log.apply(e,[this.prefix].concat(n))}}}]),hr);function hr(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];Nn(this,hr),Object.assign(this,{prefix:e,enabled:t})}var pr="nbc-identity",vr=(Bn(gr,null,[{key:"restore",value:function(e,t,n,r){var o=1<arguments.length&&void 0!==t?t:null,i=2<arguments.length&&void 0!==n?n:null,a=3<arguments.length&&void 0!==r?r:null,s=(s=localStorage.getItem(pr))?JSON.parse(s):{};return Date.now()>s.timestamp+1e3*e.sessionTimeout||o&&s.env!==o||i&&s.key!==i||a&&s.token!==a?null:(Date.now()<s.timestamp+1e3*e.userTimeout?s.user=new Zn(e,s.user):s.user=null,new gr(s))}},{key:"store",value:function(e,t,n,r){var o=new gr({env:e,key:t,token:n,user:r,timestamp:Date.now()}),i=JSON.stringify(o);return localStorage.setItem(pr,i),o}},{key:"clear",value:function(){localStorage.removeItem(pr)}}]),gr);function gr(e){var t=e.env,n=e.key,r=e.token,o=e.user,i=e.timestamp;Nn(this,gr),Object.assign(this,{env:t,key:n,token:r,user:o,timestamp:i}),Object.freeze(this)}var mr=(Bn(yr,[{key:"updateGlobalProp",value:function(e,t){this._globalProps[e]=t}},{key:"trigger",value:function(e){var t,n,o,r,i,a,s=this,u=Object.assign({},this._globalProps,e);u.version&&(t=u.enablePopUp,n=u.enableIframe,o=new URLSearchParams,Object.keys(this._redirectMap).forEach(function(e){var t=s._redirectMap[e];if(u[t]){var n=void 0;switch(e){case"properties":n=u[t].join(",");break;case"token":s._useCookie||(n=u[t]);break;default:n=u[t]}n&&o.set(e,n)}else{var r=void 0;switch(e){case"topbar":!1===u[t]&&(r=u[t])}void 0!==r&&o.set(e,r)}}),r=/^(3|4)[0-9]{1,3}$/.test(location.port)?"http://"+location.hostname+":4000":"v"+u.version+"/authenticate/",(i=new URL(r,this._serverController.getSdkUrl())).hash=o.toString(),a=i.toString(),t?(this._popUpController.setTarget(i.origin),this._popUpController.open(a,"NBCUniversal Authenticate",375,750)):n?(this._iframeController.setTarget(i.origin),this._iframeController.openIframe(a,u.propertyEdit)):location.href=a)}},{key:"parseUrlParameters",value:function(){var e=void 0,t=void 0,n=[],r=new URLSearchParams(location.hash.substr(1)),o=["nbcIdentityResult","nbcIdentityHash"];this._useCookie||(o.push("nbcIdentityToken"),o.push("nbcIdentityOptIns"));var i,a=!1;return o.some(function(e){return r.has(e)&&(a=!0),a}),a&&(t=r.get(o[0]),i=r.get(o[1]),this._useCookie||(e=r.get(o[2]),r.get(o[3])&&(n=r.get(o[3]).split(","))),o.forEach(function(e){return r.delete(e)}),location.hash=(i||"")+(i&&""!==r.toString()?"&":"")+(r||"")),{optIns:n,token:e,result:t}}}]),yr);function yr(e,t,n,r){Nn(this,yr),this._globalProps=e,this._serverController=t,this._popUpController=n,this._iframeController=r,this._redirectMap={debug:"debug",env:"env",fbToken:"facebookToken",Identity:"version",key:"key",marketingReferrer:"marketingReferrer",nbcIdentityCrossApp:"crossApp",nbcIdentityEdit:"propertyEdit",nbcIdentityLogout:"logout",nbcIdentityNative:"native",nbcIdentityPopUp:"enablePopUp",nbcIdentityIframe:"enableIframe",nbcIdentityToken:"token",nbcIdentityDefaultPage:"defaultPage",origin:"origin",redirect:"redirectUrl",properties:"properties",topbar:"topbar",useLocalConfig:"useLocalConfig",requestPrompt:"requestPrompt",configLocationHost:"configLocationHost"}}function br(e,t){var n=1<arguments.length&&void 0!==t?t:"div",r=document.createElement(n);return r.id=e,r}function _r(e,t,n,r){var o=document.getElementById(kr);if(o)return o.querySelector("iframe");var i,a,s=(i=e,(a=br(wr,"iframe")).src=i,a.frameBorder=0,a),u=function(e,t,n){var r=(e.iFrameModal||{}).iconColor||"#f1f1f1",o=br(wr+"-close-button","button");o.ariaLabel="Close NBCUniversal Identity Dialog",o.onclick=t,o.innerHTML='\n    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20">\n      <path\n        fill="'+r+'"\n        fill-rule="evenodd"\n        d="M.224 17.846L8.75 9.559.224 1.282C.074 1.137 0 .96 0 .75 0 .54.075.363.224.217.374.073.557\n0 .772 0c.216 0 .398.073.548.217l8.514 8.287L18.357.217c.15-.144.332-.217.546-.217.214 0\n.394.073.54.217.15.146.224.323.224.533 0 .21-.075.387-.224.532L10.929 9.56l8.514\n8.287c.15.145.224.321.224.527 0 .207-.075.382-.224.528-.143.149-.323.223-.54.223-.221\n0-.403-.074-.546-.223l-8.523-8.277-8.514 8.277c-.153.149-.335.223-.545.223-.214\n0-.398-.074-.55-.223-.15-.146-.225-.321-.225-.528 0-.206.075-.382.224-.527z"\n      />\n    </svg>\n  ';var i=br(wr+"-topbar"),a=br(wr+"-topbar-spacing","div");return n&&e.manageProfile&&((a=br(wr+"-topbar-heading","h1")).innerHTML=e.manageProfile.iframeTitle,a.tabIndex=-1,i.classList.add("is-manage-profile")),i.appendChild(a),i.appendChild(o),i}(t,n,r),l=function(e,t){if(t&&(e.manageProfile||{}).iframeHeader){var n=br(wr+"-titlebar"),r=br(wr+"-titlebar-heading","h2");return r.innerHTML=(e.manageProfile||{}).iframeHeader,n.appendChild(r),n}}(t,r),c=br(wr+"-inner"),f=br(wr+"-modal"),d=br(kr);c.appendChild(u),l&&c.appendChild(l),c.appendChild(s),f.appendChild(c),d.appendChild(f),document.body.appendChild(d),document.body.style.overflow="hidden";var h=document.getElementById(wr+"-topbar-heading");return h&&h.focus(),s}var wr="identity-window-iframe",kr=wr+"-wrapper",Sr="nbc-identity-window",Pr=(Bn(Er,[{key:"init",value:function(){this._logger.log("Popup controller initialized");var e=localStorage.getItem(Sr);e&&(e=JSON.parse(e)).target&&this.setTarget(e.target),window.addEventListener("message",this.onMessage,!1),this._isInit=!0}},{key:"targetInit",value:function(){this.init(),(window.opener||window.parent)&&(this._messageSource=window.opener||window.parent),this.pingPong()}},{key:"remove",value:function(){this._isInit=!1,window.removeEventListener("message",this.onMessage,!1)}},{key:"postMessage",value:function(e){if(!this._messageSource){if(!window.opener&&!window.parent)return;this._messageSource=window.opener||window.parent}this._logger.log("Message sent:",e,this._targetOrigin),this._messageSource.postMessage({source:"identity",message:JSON.stringify(e)},this._targetOrigin)}},{key:"setSource",value:function(e){this._logger.log("Source set:",e),this._messageSource=e}},{key:"setTarget",value:function(e){this._logger.log("Target set:",e),this._targetOrigin=e,localStorage.setItem(Sr,JSON.stringify({target:e}))}},{key:"isPopUpClosed",value:function(){return!this._popUpWindow||this._popUpWindow.closed||void 0===this._popUpWindow.closed}},{key:"open",value:function(e,t,n,r){var o=(screen.width-n)/2,i=(screen.height-r)/2;this._popUpWindow=window.open(e,t,"scrollbars=yes, width="+n+", height="+r+", top="+i+", left="+o),this.isPopUpClosed()?this._setState("pop-up-blocked"):(window.focus&&this._popUpWindow.focus(),this.setSource(this._popUpWindow),this.startPopUpTimer())}},{key:"openIframe",value:function(t,e){var n=this,r=1<arguments.length&&void 0!==e&&e,o=this._config&&this._config.theme||{};this.loadIFrameStyling().then(function(){var e=_r(t,o,n.closeIframe,r);e&&n.setSource(e.contentWindow)})}},{key:"closeIframe",value:function(){var e=new Event("exitIdentitySDK");window.dispatchEvent(e),document.body.style.overflow="";var t=document.getElementById(kr);t&&t.remove()}},{key:"startPopUpTimer",value:function(){var e=this;this._popUpTimer||(this._popUpTimer=window.setInterval(function(){e.isPopUpClosed()&&e.onClose()},1e3))}},{key:"pingPong",value:function(){var e=this;this._pingTimer||(this._pingTimer=window.setInterval(function(){e.postMessage("ping")},2e3))}},{key:"handlePing",value:function(){this._popUpWindow&&this._popUpTimer||(this._popUpWindow=this._messageSource,this.startPopUpTimer())}},{key:"onMessage",value:function(e){var t;e.origin===this._targetOrigin&&e.data&&"identity"===e.data.source&&(this._messageSource=e.source,!e.data.message||(t=JSON.parse(e.data.message))&&("closing"===t&&this.onClose(!0),"ping"===t&&this.handlePing(),this._onMessageCallback&&this._onMessageCallback(t)))}},{key:"onClose",value:function(e){if(window.clearInterval(this._popUpTimer),this._popUpTimer=null,window.clearInterval(this._pingTimer),this._pingTimer=null,this._onCloseCallback)return this._onCloseCallback(e)}},{key:"loadIFrameStyling",value:function(){var o=this;return new Promise(function(e){var t,n="identity-iframe-google-font";document.getElementById(n)||((t=document.createElement("link")).id=n,t.href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro&display=swap",t.rel="stylesheet",document.head.appendChild(t));var m,r=o._config&&o._config.theme||{};m=r,new Promise(function(e){var t="identity-window-style",n=document.getElementById(t);if(n)return e(n);var r=m.manageProfile,o=void 0===r?{}:r,i=m.iFrameModal,a=void 0===i?{}:i,s=m.topbar,u=void 0===s?{}:s,l=o.gradient&&function(e){if(e){var t=e.colors,n="linear-gradient("+e.direction;return t.reduce(function(e,t){return e+", "+t},n)+");"}}(o.gradient),c=a.modalBackground||"#000",f=a.fillBackground||"rgba(0, 0, 0, 0.75)",d=o.titleColor||"#fff",h=o.headerColor||"#fff",p=o.headerBackgroundColor||"#313134",v=void 0,v=u.backgroundImage?"url('"+u.backgroundImage+"')":u.backgroundColor||"#000",g=br(t,"style");g.type="text/css",g.appendChild(document.createTextNode("\n    #"+wr+" {\n      width: 100%;\n      height: 100%;\n      background: "+c+";\n    }\n\n    #"+wr+"-inner {\n      width: 100%;\n      height: 100%;\n      display: flex;\n      flex-direction: column;\n      overflow: hidden;\n    }\n\n    #"+wr+"-modal {\n      height: 100%;\n      width: 100%;\n      max-width: 100%;\n      background: "+c+";\n      box-sizing: border-box;\n    }\n\n    #"+wr+"-wrapper {\n      position: fixed;\n      top: 0;\n      left: 0;\n      display: flex;\n      align-items: flex-start;\n      justify-content: center;\n      width: 100vw;\n      height: 100%;\n      background: "+f+";\n      z-index: 9999999;\n    }\n\n    #"+wr+"-topbar {\n      display: flex;\n      align-items: center;\n      justify-content: space-between;\n      height: 58px;\n      width: 100%;\n      background: "+v+";\n    }\n\n    #"+wr+"-topbar.is-manage-profile {\n      background: "+l+"\n    }\n\n    #"+wr+"-topbar-heading {\n      margin: 0;\n      padding: 0 15px;\n      font-family: 'Source Sans Pro', sans-serif;\n      font-size: 20px;\n      font-weight: 400;\n      color: "+d+";\n    }\n\n    #"+wr+"-topbar-heading:focus {\n      outline: none;\n      box-shadow: none;\n    }\n\n    #"+wr+"-close-button {\n      width: 54px;\n      height: 58px;\n      margin: 0;\n      padding: 8px;\n      appearance: none;\n      -webkit-appearance: none;\n      background: none;\n      border: none;\n      cursor: pointer;\n    }\n\n    #"+wr+"-titlebar {\n      padding: 6px 15px 12px;\n      width: 100%;\n      background: "+p+";\n      box-sizing: border-box;\n    }\n\n    #"+wr+"-titlebar-heading {\n      margin: 0;\n      font-family: 'Source Sans Pro', sans-serif;\n      font-size: 16px;\n      font-weight: normal;\n      line-height: 1.6;\n      color: "+h+";\n    }\n\n    @media screen and (min-width: 376px) {\n      #"+wr+"-modal {\n        margin-top: 30px;\n        height: calc(100% - 70px);\n        max-height: 825px;\n        width: 375px;\n      }\n    }\n  ")),g.addEventListener("load",function(){return e(g)}),document.head.appendChild(g)}).then(e)})}},{key:"isInit",get:function(){return this._isInit}}]),Er);function Er(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};Nn(this,Er),this._pingTimer=null,this._popUpTimer=null,this._isInit=!1,this._logger=new dr("Identity-Window"),this._logger.enabled=e.debug,this._config=null,e.targetOrigin&&this.setTarget(e.targetOrigin),e.onMessage&&(this._onMessageCallback=e.onMessage),e.onClose&&(this._onCloseCallback=e.onClose),e.config&&(this._config=e.config),this.onMessage=this.onMessage.bind(this),this.onClose=this.onClose.bind(this)}function Or(e){return(Or="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Cr(t,e){var n,r=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)),r}function Ur(o){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?Cr(i,!0).forEach(function(e){var t,n,r;t=o,r=i[n=e],n in t?Object.defineProperty(t,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[n]=r}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):Cr(i).forEach(function(e){Object.defineProperty(o,e,Object.getOwnPropertyDescriptor(i,e))})}return o}function Ir(e){function t(e,t){Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor),this.message=e,this.code=t}return(t.prototype=new Error).name=e,t.prototype.constructor=t}var Tr=Ir("LaunchDarklyUnexpectedResponseError"),jr=Ir("LaunchDarklyInvalidEnvironmentIdError"),Rr=Ir("LaunchDarklyInvalidUserError"),Dr=Ir("LaunchDarklyInvalidEventKeyError"),xr=Ir("LaunchDarklyInvalidArgumentError"),Ar=Ir("LaunchDarklyFlagFetchError");function Lr(e){return!(400<=e&&e<500)||400===e||408===e||429===e}for(var Mr=Object.freeze({__proto__:null,LDUnexpectedResponseError:Tr,LDInvalidEnvironmentIdError:jr,LDInvalidUserError:Rr,LDInvalidEventKeyError:Dr,LDInvalidArgumentError:xr,LDFlagFetchError:Ar,isHttpErrorRecoverable:Lr}),Fr=function(e){for(var t,n=e.length,r=n%3,o=[],i=0,a=n-r;i<a;i+=16383)o.push(function(e,t,n){for(var r,o=[],i=t;i<n;i+=3)r=(e[i]<<16&16711680)+(e[i+1]<<8&65280)+(255&e[i+2]),o.push(Nr[r>>18&63]+Nr[r>>12&63]+Nr[r>>6&63]+Nr[63&r]);return o.join("")}(e,i,a<i+16383?a:i+16383));return 1==r?(t=e[n-1],o.push(Nr[t>>2]+Nr[t<<4&63]+"==")):2==r&&(t=(e[n-2]<<8)+e[n-1],o.push(Nr[t>>10]+Nr[t>>4&63]+Nr[t<<2&63]+"=")),o.join("")},Nr=[],Br=[],Hr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",qr=0,zr=Hr.length;qr<zr;++qr)Nr[qr]=Hr[qr],Br[Hr.charCodeAt(qr)]=qr;Br["-".charCodeAt(0)]=62,Br["_".charCodeAt(0)]=63;var Vr=Array.isArray,Jr=Object.keys,Wr=Object.prototype.hasOwnProperty,Gr=["key","secondary","ip","country","email","firstName","lastName","avatar","name"];function Kr(e){var t=unescape(encodeURIComponent(e));return Fr(function(e){for(var t=[],n=0;n<e.length;n++)t.push(e.charCodeAt(n));return t}(t))}function $r(e){return Kr(e).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function Xr(e){return JSON.parse(JSON.stringify(e))}function Zr(e,t){return function e(t,n){if(t===n)return!0;if(t&&n&&"object"==typeof t&&"object"==typeof n){var r,o,i,a=Vr(t),s=Vr(n);if(a&&s){if((o=t.length)!=n.length)return!1;for(r=o;0!=r--;)if(!e(t[r],n[r]))return!1;return!0}if(a!=s)return!1;var u=t instanceof Date,l=n instanceof Date;if(u!=l)return!1;if(u&&l)return t.getTime()==n.getTime();var c=t instanceof RegExp,f=n instanceof RegExp;if(c!=f)return!1;if(c&&f)return t.toString()==n.toString();var d=Jr(t);if((o=d.length)!==Jr(n).length)return!1;for(r=o;0!=r--;)if(!Wr.call(n,d[r]))return!1;for(r=o;0!=r--;)if(!e(t[i=d[r]],n[i]))return!1;return!0}return t!=t&&n!=n}(e,t)}function Qr(e){setTimeout(e,0)}function Yr(e,t){var n=e.then(function(e){return t&&setTimeout(function(){t(null,e)},0),e},function(e){return t?void setTimeout(function(){t(e,null)},0):Promise.reject(e)});return t?void 0:n}function eo(e){var t={};for(var n in e)ao(e,n)&&(t[n]={value:e[n],version:0});return t}function to(e){var t={};for(var n in e)ao(e,n)&&(t[n]=e[n].value);return t}function no(e,t){for(var n,r=t.slice(0),o=[],i=e;0<r.length;){for(n=[];0<i;){var a=r.shift();if(!a)break;(i-=$r(JSON.stringify(a)).length)<0&&0<n.length?r.unshift(a):n.push(a)}i=e,o.push(n)}return o}function ro(e){var t=e.version||"3.2.8";return e.userAgent+"/"+t}function oo(e,t){if(t&&!t.sendLDHeaders)return{};var n={"X-LaunchDarkly-User-Agent":ro(e)};return t&&t.wrapperName&&(n["X-LaunchDarkly-Wrapper"]=t.wrapperVersion?t.wrapperName+"/"+t.wrapperVersion:t.wrapperName),n}function io(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.reduce(function(e,t){return Ur({},e,{},t)},{})}function ao(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function so(e){if(!e)return e;var t;for(var n in Gr){var r=Gr[n],o=e[r];void 0!==o&&"string"!=typeof o&&((t=t||Ur({},e))[r]=String(o))}return t||e}Object.freeze({__proto__:null,btoa:Kr,base64URLEncode:$r,clone:Xr,deepEquals:Zr,onNextTick:Qr,wrapPromiseCallback:Yr,transformValuesToVersionedValues:eo,transformVersionedValuesToValues:to,chunkUserEventsForUrl:no,getLDUserAgentString:ro,getLDHeaders:oo,extend:io,objectHasOwnProperty:ao,sanitizeUser:so});for(var uo,lo,co,fo,ho,po=(lo=uo={exports:{}},(ho="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto))?(co=new Uint8Array(16),lo.exports=function(){return ho(co),co}):(fo=new Array(16),lo.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),fo[t]=e>>>((3&t)<<3)&255;return fo}),uo.exports),vo=[],go=0;go<256;++go)vo[go]=(go+256).toString(16).substr(1);var mo,yo,bo=0,_o=0,wo=function(e,t,n){var r,o=t&&n||0,i=t||[],a=(e=e||{}).node||mo,s=void 0!==e.clockseq?e.clockseq:yo;null!=a&&null!=s||(r=po(),null==a&&(a=mo=[1|r[0],r[1],r[2],r[3],r[4],r[5]]),null==s&&(s=yo=16383&(r[6]<<8|r[7])));var u=void 0!==e.msecs?e.msecs:(new Date).getTime(),l=void 0!==e.nsecs?e.nsecs:_o+1,c=u-bo+(l-_o)/1e4;if(c<0&&void 0===e.clockseq&&(s=s+1&16383),(c<0||bo<u)&&void 0===e.nsecs&&(l=0),1e4<=l)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");bo=u,yo=s;var f=(1e4*(268435455&(u+=122192928e5))+(_o=l))%4294967296;i[o++]=f>>>24&255,i[o++]=f>>>16&255,i[o++]=f>>>8&255,i[o++]=255&f;var d=u/4294967296*1e4&268435455;i[o++]=d>>>8&255,i[o++]=255&d,i[o++]=d>>>24&15|16,i[o++]=d>>>16&255,i[o++]=s>>>8|128,i[o++]=255&s;for(var h,p=0;p<6;++p)i[o+p]=a[p];return t||(h=0,[vo[i[h++]],vo[i[h++]],vo[i[h++]],vo[i[h++]],"-",vo[i[h++]],vo[i[h++]],"-",vo[i[h++]],vo[i[h++]],"-",vo[i[h++]],vo[i[h++]],"-",vo[i[h++]],vo[i[h++]],vo[i[h++]],vo[i[h++]],vo[i[h++]],vo[i[15]]].join(""))};function ko(u,e,t){var o="/a/"+e+".gif",l=io({"Content-Type":"application/json"},oo(u,t)),i=u.httpFallbackPing,s={sendChunk:function(e,t,n,r){var a=JSON.stringify(e),s=n?null:wo();return r?function o(i){var e=n?l:io({},l,{"X-LaunchDarkly-Event-Schema":"3","X-LaunchDarkly-Payload-ID":s});return u.httpRequest("POST",t,e,a).promise.then(function(e){if(e)return 400<=e.status&&Lr(e.status)&&i?o(!1):(n={status:e.status},!(r=e.header("date"))||(t=Date.parse(r))&&(n.serverTime=t),n);var t,n,r}).catch(function(){return i?o(!1):Promise.reject()})}(!0).catch(function(){}):(i&&i(t+o+"?d="+$r(a)),Promise.resolve())},sendEvents:function(e,t,n){if(!u.httpRequest)return Promise.resolve();for(var r=u.httpAllowsPost(),o=r?[e]:no(2e3-t.length,e),i=[],a=0;a<o.length;a++)i.push(s.sendChunk(o[a],t,n,r));return Promise.all(i)}};return s}function So(e){var t={},u=e.allAttributesPrivate,l=e.privateAttributeNames||[],c={key:!0,custom:!0,anonymous:!0},f={key:!0,secondary:!0,ip:!0,country:!0,email:!0,firstName:!0,lastName:!0,avatar:!0,name:!0,anonymous:!0,custom:!0};return t.filterUser=function(e){if(!e)return null;function t(o,i){return Object.keys(o).reduce(function(e,t){var n,r=e;return i(t)&&(c[n=t]||!u&&-1===a.indexOf(n)&&-1===l.indexOf(n)?r[0][t]=o[t]:r[1][t]=!0),r},[{},{}])}var n,a=e.privateAttributeNames||[],r=t(e,function(e){return f[e]}),o=r[0],i=r[1];e.custom&&(n=t(e.custom,function(){return 1}),o.custom=n[0],i=io({},i,n[1]));var s=Object.keys(i);return s.length&&(s.sort(),o.privateAttrs=s),o},t}function Po(e){return e&&e.message?e.message:"string"==typeof e||e instanceof String?e:JSON.stringify(e)}var Eo=" Please see https://docs.launchdarkly.com/docs/js-sdk-reference#section-initializing-the-client for instructions on SDK initialization.",Oo=function(e){return'Expected application/json content type but got "'+e+'"'},Co=function(e){return"network error"+(e?" ("+e+")":"")},Uo=function(e){return'Custom event "'+e+'" does not exist'},Io=function(){return"Environment not found. Double check that you specified a valid environment/client-side ID."+Eo},To=function(){return"No environment/client-side ID was specified."+Eo},jo=function(e){return"Error fetching flag settings: "+Po(e)},Ro=function(){return"No user specified."+Eo},Do=function(){return"Invalid user specified."+Eo},xo=function(){return"LaunchDarkly client was initialized with bootstrap data that did not include flag metadata. Events may not be sent correctly."+Eo},Ao=function(e,t){return t?'"'+e+'" is deprecated, please use "'+t+'"':'"'+e+'" is deprecated'},Lo=function(e,t,n){return"Received error "+e+(401===e?" (invalid SDK key)":"")+" for "+t+" - "+(Lr(e)?n:"giving up permanently")},Mo=function(){return"Cannot make HTTP requests in this environment."+Eo},Fo=function(e){return"Opening stream connection to "+e},No=function(e,t){return"Error on stream connection: "+Po(e)+", will continue retrying every "+t+" milliseconds."},Bo=function(e){return'Ignoring unknown config option "'+e+'"'},Ho=function(e,t,n){return'Config option "'+e+'" should be of type '+t+", got "+n+", using default value"},qo=function(e,t){return'Config option "'+e+'" should be a boolean, got '+t+", converting to boolean"},zo=function(e,t,n){return'Config option "'+e+'" was set to '+t+", changing to minimum value of "+n},Vo=function(e){return"polling for feature flags at "+e},Jo=function(e){return'received streaming update for flag "'+e+'"'},Wo=function(e){return'received streaming update for flag "'+e+'" but ignored due to version check'},Go=function(e){return'received streaming deletion for flag "'+e+'"'},Ko=function(e){return'received streaming deletion for flag "'+e+'" but ignored due to version check'},$o=function(e){return'enqueueing "'+e+'" event'},Xo=function(e){return"sending "+e+" events"},Zo=Object.freeze({__proto__:null,clientInitialized:function(){return"LaunchDarkly client initialized"},clientNotReady:function(){return"LaunchDarkly client is not ready"},eventCapacityExceeded:function(){return"Exceeded event queue capacity. Increase capacity to avoid dropping events."},eventWithoutUser:function(){return"Be sure to call `identify` in the LaunchDarkly client: https://docs.launchdarkly.com/docs/js-sdk-reference#section-analytics-events"},invalidContentType:Oo,invalidKey:function(){return"Event key must be a string"},localStorageUnavailable:function(){return"localStorage is unavailable"},localStorageUnavailableForUserId:function(){return"localStorage is unavailable, so anonymous user ID cannot be cached"},networkError:Co,unknownCustomEventKey:Uo,environmentNotFound:Io,environmentNotSpecified:To,errorFetchingFlags:jo,userNotSpecified:Ro,invalidUser:Do,bootstrapOldFormat:xo,bootstrapInvalid:function(){return"LaunchDarkly bootstrap data is not available because the back end could not read the flags."},deprecated:Ao,httpErrorMessage:Lo,httpUnavailable:Mo,identifyDisabled:function(){return"identify() has no effect here; it must be called on the main client instance"},streamClosing:function(){return"Closing stream connection"},streamConnecting:Fo,streamError:No,unknownOption:Bo,wrongOptionType:Ho,wrongOptionTypeBoolean:qo,optionBelowMinimum:zo,debugPolling:Vo,debugStreamPing:function(){return"received ping message from stream"},debugStreamPut:function(){return"received streaming update for all flags"},debugStreamPatch:Jo,debugStreamPatchIgnored:Wo,debugStreamDelete:Go,debugStreamDeleteIgnored:Ko,debugEnqueueingEvent:$o,debugPostingEvents:Xo,debugPostingDiagnosticEvent:function(e){return"sending diagnostic event ("+e.kind+")"}}),Qo=function(r){var t=!1,n=!1,o=null,e=null,i=new Promise(function(t){r.on("ready",function e(){r.off("ready",e),t()})}).catch(function(){});return{getInitializationPromise:function(){return e||(t?Promise.resolve():n?Promise.reject(o):e=new Promise(function(t,n){r.on("initialized",function e(){r.off("initialized",e),t()}),r.on("failed",function e(t){r.off("failed",e),n(t)})}))},getReadyPromise:function(){return i},signalSuccess:function(){t||n||(t=!0,r.emit("initialized"),r.emit("ready"))},signalFailure:function(e){t||n||(n=!0,o=e,r.emit("failed",e),r.emit("ready")),r.maybeReportError(e)}}};function Yo(n,r,o,i,a){var s={};function u(){var e="",t=i.getUser();return t&&(e=o||Kr(JSON.stringify(t))),"ld:"+r+":"+e}return s.loadFlags=function(){return n.get(u()).then(function(e){if(null==e)return null;try{var t,n=JSON.parse(e);return n&&(void 0===(t=n.$schema)||t<1?n=eo(n):delete n.$schema),n}catch(e){return s.clearFlags().then(function(){return Promise.reject(e)})}}).catch(function(e){return a.warn("localStorage is unavailable"),Promise.reject(e)})},s.saveFlags=function(e){var t=io({},e,{$schema:1});return n.set(u(),JSON.stringify(t)).catch(function(e){return a.warn("localStorage is unavailable"),Promise.reject(e)})},s.clearFlags=function(){return n.clear(u()).catch(function(e){return a.warn("localStorage is unavailable"),Promise.reject(e)})},s}function ei(h,p,a){var s=p.baseUrl,u=p.useReport,l=p.evaluationReasons,c=p.logger,e={},v={};function f(e,t){if(!h.httpRequest)return new Promise(function(e,t){t(new Ar(Mo()))});var n=t?"REPORT":"GET",r=oo(h,p);t&&(r["Content-Type"]="application/json");var o,i,a,s,u,l,c=v[e];c||(o=function(){delete v[e]},(l={addPromise:function(t,e){i=t,a&&a(),a=e,t.then(function(e){i===t&&(s(e),o())},function(e){i===t&&(u(e),o())})}}).resultPromise=new Promise(function(e,t){s=e,u=t}),c=l,v[e]=c);var f=h.httpRequest(n,e,r,t),d=f.promise.then(function(e){if(200!==e.status)return Promise.reject(404===(t=e).status?new jr(Io()):new Ar(jo(t.statusText||String(t.status))));if(e.header("content-type")&&e.header("content-type").startsWith("application/json"))return JSON.parse(e.body);var t,n=Oo(e.header("content-type")||"");return Promise.reject(new Ar(n))},function(e){return Promise.reject(new Ar(Co(e)))});return c.addPromise(d,function(){f.cancel&&f.cancel()}),c.resultPromise}return e.fetchJSON=function(e){return f(s+e,null)},e.fetchFlagSettings=function(e,t){var n,r,o,i="";return u?(r=[s,"/sdk/evalx/",a,"/user"].join(""),o=JSON.stringify(e)):(n=$r(JSON.stringify(e)),r=[s,"/sdk/evalx/",a,"/users/",n].join("")),t&&(i="h="+t),l&&(i=i+(i?"&":"")+"withReasons=true"),r=r+(i?"?":"")+i,c.debug(Vo(r)),f(r,o)},e}var ti={baseUrl:{default:"https://app.launchdarkly.com"},streamUrl:{default:"https://clientstream.launchdarkly.com"},eventsUrl:{default:"https://events.launchdarkly.com"},sendEvents:{default:!0},streaming:{type:"boolean"},sendLDHeaders:{default:!0},inlineUsersInEvents:{default:!1},allowFrequentDuplicateEvents:{default:!1},sendEventsOnlyForVariation:{default:!1},useReport:{default:!1},evaluationReasons:{default:!1},eventCapacity:{default:100,minimum:1},flushInterval:{default:2e3,minimum:2e3},samplingInterval:{default:0,minimum:0},streamReconnectDelay:{default:1e3,minimum:0},allAttributesPrivate:{default:!1},privateAttributeNames:{default:[]},bootstrap:{type:"string|object"},diagnosticRecordingInterval:{default:9e5,minimum:2e3},diagnosticOptOut:{default:!1},wrapperName:{type:"string"},wrapperVersion:{type:"string"},stateProvider:{type:"object"}};function ni(e,t,n,r){var a=io({logger:{default:r}},ti,n),o={all_attributes_private:"allAttributesPrivate",private_attribute_names:"privateAttributeNames",samplingInterval:null};function s(e){Qr(function(){t&&t.maybeReportError(new xr(e))})}var u,l,i,c,f=io({},e||{});return c=f,Object.keys(o).forEach(function(e){var t;void 0!==c[e]&&(t=o[e],r&&r.warn(Ao(e,t)),t&&(void 0===c[t]&&(c[t]=c[e]),delete c[e]))}),i=io({},f),Object.keys(a).forEach(function(e){void 0!==i[e]&&null!==i[e]||(i[e]=a[e]&&a[e].default)}),u=f=i,l=io({},u),Object.keys(u).forEach(function(e){var t,n,r,o,i=u[e];null!=i&&(void 0===(t=a[e])?s(Bo(e)):"any"!==(n=t.type||d(t.default))&&(r=n.split("|"),o=d(i),r.indexOf(o)<0?"boolean"===n?(l[e]=!!i,s(qo(e,o))):(s(Ho(e,n,o)),l[e]=t.default):"number"===o&&void 0!==t.minimum&&i<t.minimum&&(s(zo(e,i,t.minimum)),l[e]=t.minimum)))}),l;function d(e){if(null===e)return"any";if(void 0!==e){if(Array.isArray(e))return"array";var t=Or(e);return"boolean"===t||"string"===t||"number"===t||"function"===t?t:"object"}}}var ri=Object.freeze({__proto__:null,baseOptionDefs:ti,validate:ni}).baseOptionDefs,oi=function(e){var t={diagnosticId:wo()};return e&&(t.sdkKeySuffix=6<e.length?e.substring(e.length-6):e),t},ii=function(e){var t,n,r,o;function i(e){t=e,r=n=0,o=[]}return i(e),{getProps:function(){return{dataSinceDate:t,droppedEvents:n,eventsInLastBatch:r,streamInits:o}},setProps:function(e){t=e.dataSinceDate,n=e.droppedEvents||0,r=e.eventsInLastBatch||0,o=e.streamInits||[]},incrementDroppedEvents:function(){n++},setEventsInLastBatch:function(e){r=e},recordStreamInit:function(e,t,n){var r={timestamp:e,failed:t,durationMillis:n};o.push(r)},reset:i}},ai=function(r,e,t,n,o,i){var a,s,u=!!r.diagnosticUseCombinedEvent,l="ld:"+n+":$diagnostics",c=o.eventsUrl+"/events/diagnostic/"+n,f=o.diagnosticRecordingInterval,d=e,h=!!o.streaming,p={};function v(){return{sdk:(e=Ur({},r.diagnosticSdkData),o.wrapperName&&(e.wrapperName=o.wrapperName),o.wrapperVersion&&(e.wrapperVersion=o.wrapperVersion),e),configuration:{customBaseURI:o.baseUrl!==ri.baseUrl.default,customStreamURI:o.streamUrl!==ri.streamUrl.default,customEventsURI:o.eventsUrl!==ri.eventsUrl.default,eventsCapacity:o.eventCapacity,eventsFlushIntervalMillis:o.flushInterval,reconnectTimeMillis:o.streamReconnectDelay,streamingDisabled:!h,allAttributesPrivate:!!o.allAttributesPrivate,inlineUsersInEvents:!!o.inlineUsersInEvents,diagnosticRecordingIntervalMillis:o.diagnosticRecordingInterval,usingSecureMode:!!o.hash,bootstrapMode:!!o.bootstrap,fetchGoalsDisabled:!o.fetchGoals,allowFrequentDuplicateEvents:!!o.allowFrequentDuplicateEvents,sendEventsOnlyForVariation:!!o.sendEventsOnlyForVariation},platform:r.diagnosticPlatformData};var e}function g(e){o.logger&&o.logger.debug(Zo.debugPostingDiagnosticEvent(e)),t.sendEvents(e,c,!0).then(function(){}).catch(function(){})}function m(){var e,t,n;g((e=(new Date).getTime(),t=Ur({kind:u?"diagnostic-combined":"diagnostic",id:i,creationDate:e},d.getProps()),u&&(t=Ur({},t,{},v())),d.reset(e),t)),s=setTimeout(m,f),a=(new Date).getTime(),!u||r.localStorage&&(n=Ur({},d.getProps()),r.localStorage.set(l,JSON.stringify(n),function(){}))}return p.start=function(){var n;u?(n=function(e){var t,n;e?(t=(a||0)+f)<=(n=(new Date).getTime())?m():s=setTimeout(m,t-n):0===Math.floor(4*Math.random())?m():s=setTimeout(m,f)},r.localStorage?r.localStorage.get(l).then(function(e){if(e)try{var t=JSON.parse(e);d.setProps(t),a=t.dataSinceDate}catch(e){}n(!0)}).catch(function(){n(!1)}):n(!1)):(g(Ur({kind:"diagnostic-init",id:i,creationDate:d.getProps().dataSinceDate},v())),s=setTimeout(m,f))},p.stop=function(){s&&clearTimeout(s)},p.setStreaming=function(e){h=e},p};function si(e,t,n,o,r){var a,i,s,u,l,c,f,d,h,p,v,g,m,y,b,_,w,k,S,P,E,O,C,U,I,T,j,R,D,x,A,L=n&&n.logger?n.logger:r&&r.logger&&r.logger.default||function(e,t){var i=["debug","info","warn","error"],a=null!=t?""===t?"":t+" ":"LD: ",s=0;e&&(s="none"===e?100:i.indexOf(e));var n={};function r(e,t,n){var r,o;s<=e&&console&&((r=console[t])&&(o=e<i.length?i[e]:"?",r.call(console,a+"["+o+"] "+n)))}return n.debug=function(e){return r(0,"log",e)},n.info=function(e){return r(1,"info",e)},n.warn=function(e){return r(2,"warn",e)},n.error=function(e){return r(3,"error",e)},n}("warn"),M=(R=L,x={},(D={}).on=function(e,t,n){x[e]=x[e]||[],x[e]=x[e].concat({handler:t,context:n})},D.off=function(e,t,n){if(x[e])for(var r=0;r<x[e].length;r++)x[e][r].handler===t&&x[e][r].context===n&&(x[e]=x[e].slice(0,r).concat(x[e].slice(r+1)))},D.emit=function(e){if(x[e])for(var t=x[e].slice(0),n=0;n<t.length;n++)t[n].handler.apply(t[n].context,Array.prototype.slice.call(arguments,1))},D.getEvents=function(){return Object.keys(x)},D.getEventListenerCount=function(e){return x[e]?x[e].length:0},D.maybeReportError=function(e){e&&(x.error?this.emit("error",e):(R||console).error(e.message))},D),F=Qo(M),N=ni(n,M,r,L),B=N.sendEvents,H=e,q=N.hash,z=ko(o,H,N),V=N.sendEvents&&!N.diagnosticOptOut,J=V?oi(H):null,W=V?ii((new Date).getTime()):null,G=V?ai(o,W,z,H,N,J):null,K=(h=o,v=H,g=W,y=(p=N).streamUrl,b=p.logger,_={},w=y+"/eval/"+v,k=p.useReport,S=p.evaluationReasons,P=p.streamReconnectDelay,E=oo(h,p),O=!1,j=T=I=U=C=null,_.connect=function(e,t,n){for(var r in I=e,T=t,j={},n||{})!function(t){j[t]=function(e){ce(!(O=!1)),n[t]&&n[t](e)}}(r);se()},_.disconnect=function(){clearTimeout(U),U=null,le()},_.isConnected=function(){return!!(C&&h.eventSourceIsActive&&h.eventSourceIsActive(C))},_),$=N.eventProcessor||function(e,t,n,r,o,i){var a,s,u,l,c,f=3<arguments.length&&void 0!==r?r:null,d=4<arguments.length&&void 0!==o?o:null,h={},p=(5<arguments.length&&void 0!==i?i:null)||ko(e,n,t),v=t.eventsUrl+"/events/bulk/"+n,g=(l=u=0,c={},(s={}).summarizeEvent=function(e){var t,n;"feature"===e.kind&&(t=e.key+":"+(null!==e.variation&&void 0!==e.variation?e.variation:"")+":"+(null!==e.version&&void 0!==e.version?e.version:""),(n=c[t])?n.count=n.count+1:c[t]={count:1,key:e.key,variation:e.variation,version:e.version,value:e.value,default:e.default},(0===u||e.creationDate<u)&&(u=e.creationDate),e.creationDate>l&&(l=e.creationDate))},s.getSummary=function(){var e={},t=!0;for(var n in c){var r=c[n],o=e[r.key];o||(o={default:r.default,counters:[]},e[r.key]=o);var i={value:r.value,count:r.count};void 0!==r.variation&&null!==r.variation&&(i.variation=r.variation),r.version?i.version=r.version:i.unknown=!0,o.counters.push(i),t=!1}return t?null:{startDate:u,endDate:l,features:e}},s.clearSummary=function(){l=u=0,c={}},s),m=So(t),y=t.inlineUsersInEvents,b=t.samplingInterval,_=t.eventCapacity,w=t.flushInterval,k=t.logger,S=[],P=0,E=!1,O=!1;function C(){return 0===b||0===Math.floor(Math.random()*b)}function U(e){S.length<_?(S.push(e),O=!1):(O||(O=!0,k.warn("Exceeded event queue capacity. Increase capacity to avoid dropping events.")),f&&f.incrementDroppedEvents())}return h.enqueue=function(e){var t,n,r,o,i,a;E||(n=t=!1,g.summarizeEvent(e),"feature"===e.kind?C()&&(t=!!e.trackEvents,n=!!(a=e).debugEventsUntilDate&&a.debugEventsUntilDate>P&&a.debugEventsUntilDate>(new Date).getTime()):t=C(),t&&U((i=io({},o=e),y||"identify"===o.kind?i.user=m.filterUser(o.user):(i.userKey=o.user.key,delete i.user),"feature"===o.kind&&(delete i.trackEvents,delete i.debugEventsUntilDate),i)),n&&(delete(r=io({},e,{kind:"debug"})).trackEvents,delete r.debugEventsUntilDate,delete r.variation,U(r)))},h.flush=function(){if(E)return Promise.resolve();var e=S,t=g.getSummary();return g.clearSummary(),t&&(t.kind="summary",e.push(t)),f&&f.setEventsInLastBatch(e.length),0===e.length?Promise.resolve():(S=[],k.debug(Xo(e.length)),p.sendEvents(e,v).then(function(e){e&&(e.serverTime&&(P=e.serverTime),Lr(e.status)||(E=!0),400<=e.status&&Qr(function(){d.maybeReportError(new Tr(Lo(e.status,"event posting","some events were dropped")))}))}))},h.start=function(){a=setTimeout(function e(){h.flush(),a=setTimeout(e,w)},w)},h.stop=function(){clearTimeout(a)},h}(o,N,H,W,M,z),X=ei(o,N,H),Z={},Q={},Y=N.streaming,ee=!1,te=!1,ne=!0,re=N.stateProvider,oe=(f=function(e){re||e&&fe({kind:"identify",key:e.key,user:e,creationDate:(new Date).getTime()})},{setUser:function(e){(d=so(e))&&f&&f(Xr(d))},getUser:function(){return d?Xr(d):null}}),ie=(l=o.localStorage,c=L,{validateUser:function(e){if(!e)return Promise.reject(new Rr(Ro()));var n=Xr(e);return null!==n.key&&void 0!==n.key?(n.key=n.key.toString(),Promise.resolve(n)):n.anonymous?(l?l.get("ld:$anonUserId").catch(function(){return null}):Promise.resolve(null)).then(function(e){if(e)return n.key=e,n;var t=wo();return n.key=t,(l?l.set("ld:$anonUserId",t).catch(function(){c.warn("localStorage is unavailable, so anonymous user ID cannot be cached")}):Promise.resolve()).then(function(){return n})}):Promise.reject(new Rr(Do()))}});function ae(e){O||(b.warn(No(e,P)),O=!0),ce(!1),le(),se(P)}function se(e){U||(e?U=setTimeout(ue,e):ue())}function ue(){var e;U=null;var t="",n={headers:E};if(h.eventSourceFactory){for(var r in null!=T&&(t="h="+T),k?h.eventSourceAllowsReport?(e=w,n.method="REPORT",n.headers["Content-Type"]="application/json",n.body=JSON.stringify(I)):(e=y+"/ping/"+v,t=""):e=w+"/"+$r(JSON.stringify(I)),S&&(t=t+(t?"&":"")+"withReasons=true"),e=e+(t?"?":"")+t,le(),b.info(Fo(e)),m=(new Date).getTime(),C=h.eventSourceFactory(e,n),j)ao(j,r)&&C.addEventListener(r,j[r]);C.onerror=ae}}function le(){C&&(b.info("Closing stream connection"),C.close(),C=null)}function ce(e){m&&g&&g.recordStreamInit(m,!e,(new Date).getTime()-m),m=null}function fe(e){H&&(re&&re.enqueueEvent&&re.enqueueEvent(e)||(e.user?(ne=!1,!B||te||o.isDoNotTrack()||(L.debug($o(e.kind)),$.enqueue(e))):ne&&(L.warn("Be sure to call `identify` in the LaunchDarkly client: https://docs.launchdarkly.com/docs/js-sdk-reference#section-analytics-events"),ne=!1)))}function de(e,t,n,r){var o=oe.getUser(),i=new Date,a=t?t.value:null;if(!N.allowFrequentDuplicateEvents){var s=JSON.stringify(a)+(o&&o.key?o.key:"")+e,u=Z[s];if(u&&i-u<3e5)return;Z[s]=i}var l={kind:"feature",key:e,user:o,value:a,variation:t?t.variationIndex:null,default:n,creationDate:i.getTime()},c=Q[e];c&&(l.version=c.flagVersion?c.flagVersion:c.version,l.trackEvents=c.trackEvents,l.debugEventsUntilDate=c.debugEventsUntilDate),(r||c&&c.trackReason)&&t&&(l.reason=t.reason),fe(l)}function he(e,t,n,r){var o,i;return Q&&ao(Q,e)&&Q[e]&&!Q[e].deleted?(i=pe(o=Q[e]),null!==o.value&&void 0!==o.value||(i.value=t)):i={value:t,variationIndex:null,reason:{kind:"ERROR",errorKind:"FLAG_NOT_FOUND"}},n&&de(e,i,t,r),i}function pe(e){return{value:e.value,variationIndex:void 0===e.variation?null:e.variation,reason:e.reason||null}}function ve(){i=!0,oe.getUser()&&K.connect(oe.getUser(),q,{ping:function(){L.debug("received ping message from stream"),X.fetchFlagSettings(oe.getUser(),q).then(function(e){return me(e||{})}).catch(function(e){M.maybeReportError(new Ar(jo(e)))})},put:function(e){var t=JSON.parse(e.data);L.debug("received streaming update for all flags"),me(t)},patch:function(e){var t,n,r,o=JSON.parse(e.data),i=Q[o.key];!i||!i.version||!o.version||i.version<o.version?(L.debug(Jo(o.key)),t={},delete(n=io({},o)).key,r=pe(Q[o.key]=n),t[o.key]=i?{previous:i.value,current:r}:{current:r},ye(t)):L.debug(Wo(o.key))},delete:function(e){var t,n=JSON.parse(e.data);!Q[n.key]||Q[n.key].version<n.version?(L.debug(Go(n.key)),t={},Q[n.key]&&!Q[n.key].deleted&&(t[n.key]={previous:Q[n.key].value}),Q[n.key]={version:n.version,deleted:!0},ye(t)):L.debug(Ko(n.key))}})}function ge(){i&&(K.disconnect(),i=!1)}function me(e){var t={};if(!e)return Promise.resolve();for(var n in Q)ao(Q,n)&&Q[n]&&(e[n]&&!Zr(e[n].value,Q[n].value)?t[n]={previous:Q[n].value,current:pe(e[n])}:e[n]&&!e[n].deleted||(t[n]={previous:Q[n].value}));for(var r in e)ao(e,r)&&e[r]&&(!Q[r]||Q[r].deleted)&&(t[r]={current:pe(e[r])});return Q=Ur({},e),ye(t).catch(function(){})}function ye(o){var i,e=Object.keys(o);return 0<e.length&&(i={},e.forEach(function(e){var t=o[e].current,n=t?t.value:void 0,r=o[e].previous;M.emit("change:"+e,n,r),i[e]=t?{current:n,previous:r}:{previous:r}}),M.emit("change",i),M.emit("internal-change",Q),N.sendEventsOnlyForVariation||re||e.forEach(function(e){de(e,o[e].current)})),a&&u?u.saveFlags(Q).catch(function(){return null}):Promise.resolve()}function be(){var e=Y||s&&void 0===Y;e&&!i?ve():!e&&i&&ge(),G&&G.setStreaming(e)}function _e(e){return"change"===e||"change:"===e.substr(0,"change".length+1)}function we(e){H=e.environment,oe.setUser(e.user),Q=Ur({},e.flags),Qr(ke)}function ke(){L.info("LaunchDarkly client initialized"),ee=!0,be(),F.signalSuccess()}function Se(e){F.signalFailure(e)}return o.localStorage&&(u=new Yo(o.localStorage,H,q,oe,L)),"string"==typeof N.bootstrap&&"LOCALSTORAGE"===N.bootstrap.toUpperCase()&&(u?a=!0:L.warn("localStorage is unavailable")),"object"===Or(N.bootstrap)&&(Q=function(n){var e=Object.keys(n),r=n.$flagsState;!r&&e.length&&L.warn(xo()),!1===n.$valid&&L.warn("LaunchDarkly bootstrap data is not available because the back end could not read the flags.");var o={};return e.forEach(function(e){var t;"$flagsState"!==e&&"$valid"!==e&&(t={value:n[e]},r&&r[e]?t=io(t,r[e]):t.version=0,o[e]=t)}),o}(N.bootstrap)),re?((A=re.getInitialState())?we(A):re.on("init",we),re.on("update",function(e){e.user&&oe.setUser(e.user),e.flags&&me(e.flags)})):(e?ie.validateUser(t).then(function(e){return oe.setUser(e),"object"===Or(N.bootstrap)?ke():a?u.loadFlags().catch(function(){return null}).then(function(e){return null==e?(Q={},X.fetchFlagSettings(oe.getUser(),q).then(function(e){return me(e||{})}).then(ke).catch(function(e){Se(new Ar(jo(e)))})):(Q=e,Qr(ke),X.fetchFlagSettings(oe.getUser(),q).then(me).catch(function(e){return M.maybeReportError(e)}))}):X.fetchFlagSettings(oe.getUser(),q).then(function(e){Q=e||{},ke()}).catch(function(e){Q={},Se(e)})}):Promise.reject(new jr(To()))).catch(Se),{client:{waitForInitialization:function(){return F.getInitializationPromise()},waitUntilReady:function(){return F.getReadyPromise()},identify:function(e,r,t){return te?Yr(Promise.resolve({}),t):re?(L.warn("identify() has no effect here; it must be called on the main client instance"),Yr(Promise.resolve(to(Q)),t)):Yr((a&&u?u.clearFlags():Promise.resolve()).then(function(){return ie.validateUser(e)}).then(function(n){return X.fetchFlagSettings(n,r).then(function(e){var t=to(e);return oe.setUser(n),q=r,e?me(e).then(function(){return t}):t})}).then(function(e){return i&&ve(),e}).catch(function(e){return M.maybeReportError(e),Promise.reject(e)}),t)},getUser:function(){return oe.getUser()},variation:function(e,t){return he(e,t,!0,!1).value},variationDetail:function(e,t){return he(e,t,!0,!0)},track:function(e,t,n){var r;"string"==typeof e?(o.customEventFilter&&!o.customEventFilter(e)&&L.warn(Uo(e)),r={kind:"custom",key:e,user:oe.getUser(),url:o.getCurrentUrl(),creationDate:(new Date).getTime()},null!=t&&(r.data=t),null!=n&&(r.metricValue=n),fe(r)):M.maybeReportError(new Dr(Uo(e)))},on:function(e,t,n){_e(e)?(s=!0,ee&&be(),M.on(e,t,n)):M.on.apply(M,arguments)},off:function(e){var t;M.off.apply(M,arguments),_e(e)&&(t=!1,M.getEvents().forEach(function(e){_e(e)&&0<M.getEventListenerCount(e)&&(t=!0)}),t||(s=!1,i&&void 0===Y&&ge()))},setStreaming:function(e){var t=null===e?void 0:e;t!==Y&&(Y=t,be())},flush:function(e){return Yr(B?$.flush():Promise.resolve(),e)},allFlags:function(){var e={};if(!Q)return e;for(var t in Q)ao(Q,t)&&(e[t]=he(t,null,!N.sendEventsOnlyForVariation).value);return e},close:function(e){if(te)return Yr(Promise.resolve(),e);function t(){te=!0,Q={}}return Yr(Promise.resolve().then(function(){if(ge(),G&&G.stop(),B)return $.stop(),$.flush()}).then(t).catch(t),e)}},options:N,emitter:M,ident:oe,logger:L,requestor:X,start:function(){B&&(G&&G.start(),$.start())},enqueueEvent:fe,getFlagsInternal:function(){return Q},getEnvironmentId:function(){return H},internalChangeEventName:"internal-change"}}function ui(t,e){var n,r=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)),r}var li={promise:Promise.resolve({status:200,header:function(){return null},body:null})};function ci(e){var t,i={synchronousFlush:!1};window.XMLHttpRequest&&(i.httpRequest=function(e,t,n,r){var o=i.synchronousFlush;return i.synchronousFlush=!1,function(e,t,n,r,o){if(o&&!function(){var e=window.navigator&&window.navigator.userAgent;if(e){var t=e.match(/Chrom(e|ium)\/([0-9]+)\./);if(t)return parseInt(t[2],10)<73}return 1}())return li;var i,a=new window.XMLHttpRequest;for(var s in a.open(e,t,!o),n||{})Object.prototype.hasOwnProperty.call(n,s)&&a.setRequestHeader(s,n[s]);return o?(a.send(r),li):{promise:new Promise(function(e,t){a.addEventListener("load",function(){i||e({status:a.status,header:function(e){return a.getResponseHeader(e)},body:a.responseText})}),a.addEventListener("error",function(){i||t(new Error)}),a.send(r)}),cancel:function(){i=!0,a.abort()}}}(e,t,n,r,o)}),i.httpAllowsPost=function(){return void 0===t&&(t=!!window.XMLHttpRequest&&"withCredentials"in new window.XMLHttpRequest),t},i.httpFallbackPing=function(e){(new window.Image).src=e};var r,n=e&&e.eventUrlTransformer;i.getCurrentUrl=function(){return n?n(window.location.href):window.location.href},i.isDoNotTrack=function(){var e;return 1===(e=window.navigator&&void 0!==window.navigator.doNotTrack?window.navigator.doNotTrack:window.navigator&&void 0!==window.navigator.msDoNotTrack?window.navigator.msDoNotTrack:window.doNotTrack)||!0===e||"1"===e||"yes"===e};try{window.localStorage&&(i.localStorage={get:function(t){return new Promise(function(e){e(window.localStorage.getItem(t))})},set:function(t,n){return new Promise(function(e){window.localStorage.setItem(t,n),e()})},clear:function(t){return new Promise(function(e){window.localStorage.removeItem(t),e()})}})}catch(e){i.localStorage=null}return r=e&&e.useReport&&"function"==typeof window.EventSourcePolyfill&&window.EventSourcePolyfill.supportedOptions&&window.EventSourcePolyfill.supportedOptions.method?(i.eventSourceAllowsReport=!0,window.EventSourcePolyfill):(i.eventSourceAllowsReport=!1,window.EventSource),window.EventSource&&(i.eventSourceFactory=function(e,t){var n=function(o){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?ui(Object(i),!0).forEach(function(e){var t,n,r;t=o,r=i[n=e],n in t?Object.defineProperty(t,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[n]=r}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):ui(Object(i)).forEach(function(e){Object.defineProperty(o,e,Object.getOwnPropertyDescriptor(i,e))})}return o}({},{heartbeatTimeout:3e5,silentTimeout:3e5,skipDefaultHeaders:!0},{},t);return new r(e,n)},i.eventSourceIsActive=function(e){return e.readyState===window.EventSource.OPEN||e.readyState===window.EventSource.CONNECTING}),i.userAgent="JSClient",i.version="2.17.5",i.diagnosticSdkData={name:"js-client-sdk",version:"2.17.5"},i.diagnosticPlatformData={name:"JS"},i.diagnosticUseCombinedEvent=!0,i}var fi=/[|\\{}()[\]^$+*?.]/g,di=function(e){if("string"!=typeof e)throw new TypeError("Expected a string");return e.replace(fi,"\\$&")};function hi(e,r){for(var t={},n=null,o=[],i=0;i<e.length;i++)for(var a=e[i],s=a.urls||[],u=0;u<s.length;u++)if(function(e,t,n,r){var o,i,a=t.replace(n,"").replace(r,"");switch(e.kind){case"exact":i=t,o=new RegExp("^"+di(e.url)+"/?$");break;case"canonical":i=a,o=new RegExp("^"+di(e.url)+"/?$");break;case"substring":i=a,o=new RegExp(".*"+di(e.substring)+".*$");break;case"regex":i=a,o=new RegExp(e.pattern);break;default:return}return o.test(i)}(s[u],window.location.href,window.location.search,window.location.hash)){"pageview"===a.kind?r("pageview",a):(o.push(a),r("click_pageview",a));break}return 0<o.length&&(n=function(e){for(var t=function(e,t){for(var n=[],r=0;r<t.length;r++)for(var o=e.target,i=t[r],a=i.selector,s=document.querySelectorAll(a);o&&0<s.length;){for(var u=0;u<s.length;u++)o===s[u]&&n.push(i);o=o.parentNode}return n}(e,o),n=0;n<t.length;n++)r("click",t[n])},document.addEventListener("click",n)),t.dispose=function(){document.removeEventListener("click",n)},t}var pi=300;function vi(r,i){var a,s,e={};function u(){s&&s.dispose(),a&&a.length&&(s=hi(a,l))}function l(e,t){var n={kind:e,key:t.key,data:null,url:window.location.href,user:r.ident.getUser(),creationDate:(new Date).getTime()};return"click"===e&&(n.selector=t.selector),r.enqueueEvent(n)}return e.goalKeyExists=function(e){if(!a)return!0;for(var t=0;t<a.length;t++)if("custom"===a[t].kind&&a[t].key===e)return!0;return!1},r.requestor.fetchJSON("/sdk/goals/"+r.getEnvironmentId()).then(function(e){function t(){(r=window.location.href)!==o&&(o=r,n())}var n,r,o;e&&0<e.length&&(s=hi(a=e,l),n=u,o=window.location.href,function e(t,n){t(),setTimeout(function(){e(t,n)},n)}(t,pi),window.history&&window.history.pushState?window.addEventListener("popstate",t):window.addEventListener("hashchange",t)),i()}).catch(function(e){r.emitter.maybeReportError(new Mr.LDUnexpectedResponseError((e&&e.message,e.message))),i()}),e}var gi="goalsReady",mi={fetchGoals:{default:!0},hash:{type:"string"},eventProcessor:{type:"object"},eventUrlTransformer:{type:"function"}};var yi=(Bn(bi,[{key:"init",value:function(i,a,s,u){var l=this;return new Promise(function(e,t){if(!i||!a)return t("Project Key and/or Config missing.");l._projectKey=i;var n=a.clientSideID,r=a.enabled;if(!n||!r)return t("Launch Darkly not initialized.");var o=l.buildUser(s);l._user=o,l._ldclient=function(e,t,n){var r,o=2<arguments.length&&void 0!==n?n:{},i=ci(o),a=si(e,t,o,i,mi),s=a.client,u=a.options,l=a.emitter,c=new Promise(function(e){var t=l.on(gi,function(){l.off(gi,t),e()})});function f(){i.synchronousFlush=!0,s.flush().catch(function(){}),i.synchronousFlush=!1}return s.waitUntilGoalsReady=function(){return c},u.fetchGoals?(r=vi(a,function(){return l.emit(gi)}),i.customEventFilter=r.goalKeyExists):l.emit(gi),"complete"!==document.readyState?window.addEventListener("load",a.start):a.start(),window.addEventListener("beforeunload",f),window.addEventListener("unload",f),s}(n,o),l.subscribe("change",function(e){l.onChange(e),u&&u(e)}),l.subscribe("ready",function(){return l.onReady(),e()})})}},{key:"subscribe",value:function(e,t){this._ldclient.on(e,t)}},{key:"getFlag",value:function(e){if(this._ready)return this._ldclient.variation(e)}},{key:"getAllFlags",value:function(){if(this._ready)return this._ldclient.allFlags()}},{key:"buildUser",value:function(e){this._logger.log("ldController -- build user profile:",e);var t=void 0;return e&&e.id?(t={key:e.id,anonymous:e.anonymous||!1,custom:{groups:[this._projectKey]}},e.audiences&&(t.custom.MpAudiences=e.audiences)):t={key:"no-key-provided",anonymous:!0,custom:{groups:[this._projectKey]}},this._logger.log("ldController -- user build result:",t),t}},{key:"_buildConveyorEndpoint",value:function(e){var t="https://",n=".nbc.com/sdk/api/audience/search?mpid=",r=void 0,r="production"===this._env?t+"id"+n+e:t+this._env+"-id"+n+e;return this._logger.log("ldController -- conveyor endpoint:",r),r}},{key:"_getMParticleUserAudiences",value:function(n){var r=this;return new Promise(function(t,e){n||e(),fetch(r._buildConveyorEndpoint(n)).then(function(e){if(e.ok)return e.json();throw new Error("Unable to get MParticle audiences")}).then(function(e){r._logger.log("ldController -- data when getting audiences:",e),t(e.audiences.map(function(e){return e.audienceID}))}).catch(function(){r._logger.log("ldController -- failure fetching audiences"),e()})})}},{key:"identifyUser",value:function(r,t){function e(){function n(e){o._user.key!==e.key?(o._user=e,o._ldclient.identify(e).then(function(){t&&t(o._user)})):t&&t(o._user)}o._getMParticleUserAudiences(r&&r.id||void 0).then(function(e){var t=o.buildUser(Vn({},r,{audiences:e}));n(t)}).catch(function(){var e=o.buildUser(r);n(e)})}var o=this;this._ready?e():this._addOnReadyCallback(e)}},{key:"onChange",value:function(e){this._logger.log("Launch Darkly Change",e)}},{key:"onReady",value:function(){var t=this;this._logger.log("Launch Darkly Ready"),this._ready=!0,this._onReadyCallbacks.forEach(function(e){e(t)})}},{key:"_addOnReadyCallback",value:function(e){this._onReadyCallbacks.push(e)}}]),bi);function bi(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{env:"production"};Nn(this,bi),this._logger=new dr("Identity-LD"),this._ldclient=null,this._ready=!1,this._user=null,this._env=e.env,this._onReadyCallbacks=[],this.onChange=this.onChange.bind(this),this.onReady=this.onReady.bind(this)}var _i="7.4.5";function wi(){Nn(this,wi);var e=Jn(this,(wi.__proto__||Object.getPrototypeOf(wi)).call(this));return e._state="uninitialized",e._native=!1,e._nativeController=null,e._result=null,e._message=null,e._token=null,e._topbar=!0,e._user=null,e._redirectController=null,e._popUpController=null,e._iframeController=null,e._cookieHelper=null,e._logger=new dr("Identity"),e._env=null,e._key=null,e._config=null,e._server=null,e._api=null,e._useCookie=!0,e._additionalDisabled=!1,e._isVPPARemoved=!0,e._enablePopUp=!1,e._enableIframe=!1,e._initEnablePopUp=!1,e._optIns=[],e._updateSession=e._updateSession.bind(e),e._onResult=e._onResult.bind(e),e._onPopUpMessage=e._onPopUpMessage.bind(e),e._onIframeMessage=e._onIframeMessage.bind(e),e._onPopUpClose=e._onPopUpClose.bind(e),e._onIframeClose=e._onIframeClose.bind(e),e._ldOnChange=e._ldOnChange.bind(e),e}return new(qn(wi,ir),Bn(wi,[{key:"_log",value:function(){var e;(e=this._logger).log.apply(e,arguments)}},{key:"_setState",value:function(e,t){this._log("state: "+e,t),this._state=e,t&&("message"in t&&(this._message=t.message),"result"in t&&(this._result=t.result),"token"in t&&(this._token=t.token),"user"in t&&(this._user=t.user)),this.notify("state",e)}},{key:"_setResult",value:function(e){this._log("result: "+e),this._result=e,this.notify("result",e)}},{key:"_setToken",value:function(e){this._log("token: "+e),this._token=e,this._cookieHelper.setCookie("token",e),this.notify("token",e)}},{key:"_setProfile",value:function(e){this._log("profile: ",e),this._profile=e,this._cookieHelper.setCookie("profile",JSON.stringify(e)),this.notify("profile",e)}},{key:"_updateSession",value:function(e,t,n){function r(e,t){var n=Vn({},t);i._optIns.forEach(function(e){return n[e]=!0});var r=new Zn(i._config,n);return i._setState("authenticated",{token:e,user:r}),i._log("Stored",vr.store(i._env,i._key,i._token,i._user)),i}var o=0<arguments.length&&void 0!==e?e:null,i=this,a=1<arguments.length&&void 0!==t?t:null,s=!(2<arguments.length&&void 0!==n)||n;if(!o)return vr.clear(),s&&"unauthenticated"!==this._state&&this._setState("unauthenticated",{token:null,user:null}),Promise.resolve(this);if(a)return this._setState("authenticated",{token:o,user:a}),Promise.resolve(this);switch(this._result){case"registered":case"logged in":case"completed":case"user cancelled":case"logout cancelled":var u=this._profile;this._profile=null;var l=this._cookieHelper.getCookie("profile"),c=u||l;if(!c)break;var f="string"==typeof c?JSON.parse(c):c;if(!f._id)break;return r(o,f)}return this._apiCall("getUserInfo",{newToken:o,userData:null}).then(function(e){return r(o,e)}).catch(function(e){return i._log(e.name+" fetching user by token: "+e.message,o,e),i._cookieHelper.removeCookie("token"),i._setState("unableToFetchUserData",{token:null,user:null}),i._updateSession(null,null,!1)})}},{key:"_restoreRecord",value:function(e,t,n,r){var o=3<arguments.length&&void 0!==r?r:null,i=vr.restore(e,t,n,o);return i?(this._log("Restored",i),this._updateSession(i.token,i.user)):this._updateSession(o)}},{key:"_onPopUpMessage",value:function(e){var t,n,r;e&&(t=e.token,n=e.result,r=e.user,t&&this._setToken(t),r&&this._setProfile(r),n&&this._setResult(n))}},{key:"_onPopUpClose",value:function(e){this._log("Pop-up closed"),e||"logged in"===this.result||"registered"===this.result||this._setResult("user cancelled"),this._enablePopUp||this._popUpController.remove()}},{key:"_onIframeMessage",value:function(e){var t,n,r;e&&(t=e.token,n=e.result,r=e.user,t&&this._setToken(t),r&&this._setProfile(r),n&&this._setResult(n))}},{key:"_onIframeClose",value:function(e){this._log("Iframe closed"),this._iframeController.closeIframe(),e||"logged in"===this.result||"registered"===this.result||this._setResult("user cancelled"),this._enableIframe||this._iframeController.remove()}},{key:"_onResult",value:function(e){var t=0<arguments.length&&void 0!==e&&e;if("logged out"===this._result)return this._log("Remove user session"),this._cookieHelper.removeCookie("token"),this._cookieHelper.removeCookie("profile"),this._updateSession();var n=this._result&&!/cancelled/.test(this._result);return this._token&&(n||t)?(this._log("Update user session"),this._updateSession(this._token)):this._token||!this._useCookie?(this._log("Restore user session"),this._restoreRecord(this._config,this._env,this._key,this._token)):(this._log("No user session available"),this._updateSession())}},{key:"_ldCheckFlag",value:function(e){var t=this._launchdarklyController.getFlag(e);switch(e){case"popup-feature":this._enablePopUp="boolean"==typeof t?t:this._initEnablePopUp;break;case"additional-information-screen-show":this._additionalDisabled="boolean"==typeof t&&!t;break;case"remove-registration-vppa-checkbox":this._isVPPARemoved="boolean"==typeof t&&t}return t}},{key:"_ldOnChange",value:function(){this._shouldEnablePopUp(this._enablePopUp,!0),this._ldCheckFlag("additional-information-screen-show"),this._ldCheckFlag("remove-registration-vppa-checkbox")}},{key:"_shouldEnablePopUp",value:function(e,t){var n=this,r=1<arguments.length&&void 0!==t&&t;if(this._native)return!1;function o(){n._popUpController&&!n._popUpController.isInit&&n._popUpController.init()}if(r){var i=this._ldCheckFlag("popup-feature");if(i&&o(),"boolean"==typeof i)return i}return e&&o(),e}},{key:"_isIframeSupported",value:function(){var e,t,n,r=(e=window.navigator.userAgent,t=e.indexOf("OS "),((n=-1<e.indexOf("iPhone")||-1<e.indexOf("iPad"))&&-1<t?window.Number(e.substr(t+3,3).replace("_",".")):null)||(n?12:13));return r&&12<r}},{key:"_shouldEnableIframe",value:function(e){var t=this;return e&&t._iframeController&&!t._iframeController.isInit&&t._iframeController.init(),e}},{key:"_determineUserFlow",value:function(e,t){var n=1<arguments.length&&void 0!==t&&t,r=this._isIframeSupported(),o=this._shouldEnableIframe(e.enableIframe);this._enableIframe=r&&o;var i,a=!(!o||r)||e.enablePopUp,s=this._shouldEnablePopUp(a,!0);return this._enablePopUp=s,(this._initEnablePopUp=s)?"popup":this._enableIframe?(n||(i=this._isTopbarEnabled(!0),this._redirectController.updateGlobalProp("topbar",i)),"iframe"):"redirect"}},{key:"_shouldRequestProperties",value:function(e){var t=this,n=[];return(0<arguments.length&&void 0!==e?e:[]).forEach(function(e){!1!==t._ldCheckFlag("additional-information-"+e)&&n.push(e)}),n}},{key:"_isTopbarEnabled",value:function(e){var t=0<arguments.length&&void 0!==e?e:this._enableIframe;return this._topbar||void 0===this._topbar&&!t}},{key:"_apiCall",value:function(e,t){var n;return this._api&&this._api[e]?(t.options||(t.options={}),t.options.headers||(t.options.headers={}),t.options.headers["X-IDM-Bypass-VPPA"]=!0,delete t.options.headers.vppa_re_opt_in,this._log("API Call",e),(n=this._api)[e].apply(n,function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(Object.values(t)))):Promise.reject()}},{key:"initialize",value:function(i,e){var a=this,t=1<arguments.length&&void 0!==e?e:{},n=t.debug,s=void 0!==n&&n,r=t.env,u=void 0===r?"production":r,o=t.native,l=void 0!==o&&o,c=t.token,f=void 0===c?null:c,d=t.topbar,h=t.useLocalConfig,p=void 0!==h&&h,v=t.enablePopUp,g=void 0!==v&&v,m=t.enableIframe,y=void 0!==m&&m,b=t.disableCookie,_=void 0!==b&&b,w=t.configLocationHost,k=void 0===w?null:w;return this._logger.enabled=s,this._env=u,this._key=i,this._native=l,this._native&&(this._nativeController=new sr),this._server=new cr({sdkVersion:_i,env:u,useLocalConfig:p}),this._launchdarklyController=new yi({env:u}),this._topbar=d,this._useLocalConfig=p,_&&(this._useCookie=!_),this._log({version:_i,env:u,key:i,debug:s}),this._setState("initializing"),rr.request({server:this._server,key:i,configLocationHost:k}).then(function(e){a._log("config",e),a._config=e,a._server.setConfig(e),a._server.setUrl(),a._api=new tr({server:a._server,config:e,useCookie:a._useCookie}),a._cookieHelper=new Gn(e),a._cookieHelper.setEnabled(a._useCookie),a._popUpController=new Pr({debug:s,onMessage:a._onPopUpMessage,onClose:a._onPopUpClose}),a._iframeController=new Pr({debug:s,config:e,onMessage:a._onIframeMessage,onClose:a._onIframeClose});var t=a._determineUserFlow({enableIframe:y,enablePopUp:g},!0),n=a._isTopbarEnabled("iframe"===t);a._redirectController=new mr({debug:s,env:u,key:i,native:l,topbar:n,useLocalConfig:p,version:_i,configLocationHost:k},a._server,a._popUpController,a._iframeController);var r,o=null!==f;return o&&a._cookieHelper.setCookie("token",f),f=a._cookieHelper.getCookie("token"),a._cookieSub=a._cookieHelper.subscribe("token",function(e){e===a.token&&"authenticated"===a.state||a._updateSession(e)}),o||(r=a._redirectController.parseUrlParameters())&&(r.token&&(f=r.token),a._result=r.result,a._optIns=r.optIns),a._token=f,a.on("result",a._onResult),e.launchdarkly&&e.launchdarkly.enabled&&a._launchdarklyController.init(i,e.launchdarkly,{},a._ldOnChange).then(function(){a._shouldEnablePopUp(a._enablePopUp,!0),a._ldCheckFlag("additional-information-screen-show"),a._ldCheckFlag("remove-registration-vppa-checkbox"),a._onResult(o)}).catch(function(){a._onResult(o)}),a._onResult(o)}).catch(function(e){throw a._log(e.name+" initializing: "+e.message,e),a._setState("uninitialized"),e})}},{key:"authenticate",value:function(e){var t=0<arguments.length&&void 0!==e?e:{},n=t.properties,r=void 0===n?[]:n,o=t.origin,i=void 0===o?null:o,a=t.redirectUrl,s=void 0===a?location.href:a,u=t.token,l=void 0===u?this.token:u,c=t.facebookToken,f=t.marketingReferrer,d=void 0===f?null:f,h=t.propertyEdit,p=void 0!==h&&h,v=t.enableIframe,g=void 0===v?this._enableIframe:v,m=t.enablePopUp,y=void 0===m?this._enablePopUp:m,b=t.defaultPage,_=void 0===b?null:b,w=["signUp","signupWithEmail","signIn"];if(_&&-1===w.indexOf(_))return window.console.error("Identity.authenticate error: make sure the defaultPage property is set to one of the following: "+w.join(", "));var k=this._determineUserFlow({enableIframe:g,enablePopUp:y});this._redirectController.trigger({properties:this._shouldRequestProperties(r),origin:i,redirectUrl:s,token:l,facebookToken:c,marketingReferrer:d,propertyEdit:p,enableIframe:"iframe"===k,enablePopUp:"popup"===k,requestPrompt:!this._native&&!this._useCookie&&!this._token,defaultPage:_})}},{key:"manageProfile",value:function(e){var t=0<arguments.length&&void 0!==e?e:{},n=t.marketingReferrer,r=void 0===n?null:n,o=t.defaultPage,i=void 0===o?null:o;this.authenticate({properties:["email","firstName","lastName","gender","phone","zipCode"],marketingReferrer:r,defaultPage:i,propertyEdit:!0})}},{key:"unauthenticate",value:function(e){var t=this,n=0<arguments.length&&void 0!==e?e:{},r=n.origin,o=void 0===r?null:r,i=n.redirectUrl,a=void 0===i?location.href:i,s=n.token,u=void 0===s?this.token:s,l=n.redirect,c=void 0===l||l,f=n.enablePopUp,d=void 0===f?this._enablePopUp:f,h=n.enableIframe,p=void 0===h?this._enableIframe:h;if(this._setState("unauthenticating",{result:null}),!c)return this._apiCall("unauthenticate",{token:this._token,native:this._nativeController}).catch(function(e){t._log("Unauthenticate failed",e)}).then(function(){return t._updateSession()});var v=this._determineUserFlow({enableIframe:p,enablePopUp:d});this._redirectController.trigger({logout:!0,origin:o,redirectUrl:a,token:u,enableIframe:"iframe"===v,enablePopUp:"popup"===v})}},{key:"getHealth",value:function(e,t){var o=1<arguments.length&&void 0!==t?t:1e4,i=(0<arguments.length&&void 0!==e?e:null)||this._env,a=this._server;return new Promise(function(n){if(!a){if(!i)return n("env parameter missing");a=new cr({sdkVersion:_i,env:i})}var e="https://"+("production"!==i?i+"-":"")+"id.nbc.com/status/",r=setTimeout(function(){return n(!1)},o);a.call(e,{method:"GET"}).then(function(e){clearTimeout(r);var t="status"in e&&e.status;return n(t)}).catch(function(){return clearTimeout(r),n(!1)})})}},{key:"crossAppPrompt",value:function(e){var i=this,t=0<arguments.length&&void 0!==e?e:{},n=t.origin,r=void 0===n?null:n,o=t.redirectUrl,a=void 0===o?location.href:o,s=t.enablePopUp,u=void 0===s?this._enablePopUp:s,l=t.enableIframe,c=void 0===l?this._enableIframe:l;this._origin=r,this._redirectUrl=a,this._nativeController&&(this._crossAppBridge=new Yn(this._nativeController),this._crossAppInitialized?this._crossAppBridge.command("get",{}):this._crossAppBridge.init().then(function(){i._crossAppInitialized=!0,"iOS"===window.nativeWrapper.os?(i._crossAppBridge.on("get",function(n){var e=n.payload,r=e.token,o=e.value;i._crossAppToken=r,new Promise(function(t,e){if(!r||!o)return e("The keychain is empty.");i._apiCall("getUserInfo",{token:i._crossAppToken,userData:null}).then(function(e){return i._cookieHelper.setCookie("userData",JSON.stringify(e)),t(i._crossAppToken)}).catch(function(){return i._removeKeychainData(i._crossAppToken),e("Invalid token.")})}).then(function(e){i._cookieHelper.setCookie("crossAppToken",e),i._cookieHelper.setCookie("crossApp",JSON.stringify(n.payload));var t=i._determineUserFlow({enableIframe:c,enablePopUp:u});i._redirectController.trigger({crossApp:!0,iframeEnabled:"iframe"===t,enablePopUp:"popup"===t,origin:i._origin,redirectUrl:i._redirectUrl})}).catch(function(e){return i._setState("cross-app-unavailable",{message:e})})}),i._crossAppBridge.command("get",{})):i._setState("cross-app-unavailable",{message:"crossAppPrompt call should only be used on iOS devices."})}).catch(function(){return i._setState("cross-app-unavailable",{message:"The native bridge could not be initialized."})}))}},{key:"clearUser",value:function(){vr.clear()}},{key:"version",get:function(){return _i}},{key:"state",get:function(){return this._state}},{key:"message",get:function(){return this._message}},{key:"result",get:function(){return this._result}},{key:"token",get:function(){return this._token}},{key:"user",get:function(){return this._user}},{key:"additionalInformationDisabled",get:function(){return this._additionalDisabled}}]),wi)});
